<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Qualitative explanatory variables and blocking – MPS318/4101 Sampling Theory and Design of Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Qualitative-multiple factors.html" rel="next">
<link href="./Optimality.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-27c261d06b905028a18691de25d09dde.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction to experimental design.html">Part I: Experimental Design</a></li><li class="breadcrumb-item"><a href="./Qualitative-single factor.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Qualitative explanatory variables and blocking</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MPS318/4101 Sampling Theory and Design of Experiments</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructions</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Experimental Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to experimental design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Experimental Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Review of linear models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A review of linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Optimality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality criteria</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-single factor.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Qualitative explanatory variables and blocking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-multiple factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Latin Square designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Factorial designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Factorial designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Continuous and exact designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Continuous and exact designs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Sampling Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Simple random sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Simple Random Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Sample sizes and confidence intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Confidence intervals and sample sizes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Stratified sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Stratified Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Population size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Estimating a Population Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Practicalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Reliability of sample surveys</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: MPS4101 only</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tailor-made designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Modifying designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Cluster sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Cluster Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction-computer-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction to computer experiments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Uncertainty-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Uncertainty analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Sensitivity-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Sensitivity analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#qualitative-explanatory-variables" id="toc-qualitative-explanatory-variables" class="nav-link active" data-scroll-target="#qualitative-explanatory-variables"><span class="header-section-number">4.1</span> Qualitative explanatory variables</a></li>
  <li><a href="#completely-randomised-designs-crd" id="toc-completely-randomised-designs-crd" class="nav-link" data-scroll-target="#completely-randomised-designs-crd"><span class="header-section-number">4.2</span> Completely Randomised Designs (CRD)</a>
  <ul class="collapse">
  <li><a href="#estimating-treatment-differences" id="toc-estimating-treatment-differences" class="nav-link" data-scroll-target="#estimating-treatment-differences"><span class="header-section-number">4.2.1</span> Estimating treatment differences</a></li>
  </ul></li>
  <li><a href="#reducing-variation-using-blocking" id="toc-reducing-variation-using-blocking" class="nav-link" data-scroll-target="#reducing-variation-using-blocking"><span class="header-section-number">4.3</span> Reducing variation using blocking</a></li>
  <li><a href="#sec-RBD" id="toc-sec-RBD" class="nav-link" data-scroll-target="#sec-RBD"><span class="header-section-number">4.4</span> Randomised Block Designs (RBD)</a></li>
  <li><a href="#comparing-crds-and-rbds" id="toc-comparing-crds-and-rbds" class="nav-link" data-scroll-target="#comparing-crds-and-rbds"><span class="header-section-number">4.5</span> Comparing CRDs and RBDs</a></li>
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks"><span class="header-section-number">4.6</span> Tasks</a></li>
  <li><a href="#appendix---balanced-incomplete-block-designs" id="toc-appendix---balanced-incomplete-block-designs" class="nav-link" data-scroll-target="#appendix---balanced-incomplete-block-designs"><span class="header-section-number">4.7</span> Appendix - Balanced Incomplete Block Designs</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction to experimental design.html">Part I: Experimental Design</a></li><li class="breadcrumb-item"><a href="./Qualitative-single factor.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Qualitative explanatory variables and blocking</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Qualitative explanatory variables and blocking</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Aims for this chapter
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this chapter we</p>
<ul>
<li><p>consider standard designs suitable for investigating the effects of qualitative (factor) explanatory variables;</p></li>
<li><p>introduce the concept of “blocking” as a tool to reduce unwanted variation and obtain more precise parameter estimates;</p></li>
<li><p>study the appropriate linear model for analysing such data where blocking has been used.</p></li>
</ul>
</div>
</div>
<section id="qualitative-explanatory-variables" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="qualitative-explanatory-variables"><span class="header-section-number">4.1</span> Qualitative explanatory variables</h2>
<p>In <a href="Review of linear models.html#sec-qualvars" class="quarto-xref"><span>Section 2.6</span></a> we reviewed how qualitative explanatory variables (e.g.&nbsp;which treatment is given to a patient) can be incorporated in a linear model. We will refer to a qualitative explanatory variable as a <strong>factor</strong> taking one of <span class="math inline">\(t\)</span> possible <strong>levels</strong>. If designing an experiment with a single factor explanatory variables, the design problem is to choose what level of the factor variable (e.g.&nbsp;which treatment) to apply to each experimental subject (e.g.&nbsp;each patient).</p>
</section>
<section id="completely-randomised-designs-crd" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="completely-randomised-designs-crd"><span class="header-section-number">4.2</span> Completely Randomised Designs (CRD)</h2>
<p>A typical example is where an investigator is wishing to compare <span class="math inline">\(t\)</span> different drugs, one of which may be a placebo, by dividing the patients into <span class="math inline">\(t\)</span> groups and administering a different drug to each group.</p>
<p>A <strong>completely randomised design (CRD)</strong> is one where subjects (patients) are allocated randomly to treatments, with every possible allocation of subjects to treatments equally likely to be chosen. This helps to avoid bias (e.g.&nbsp;its less likely that the healthiest patients are all allocated to the same treatment). We won’t consider this in this module, but there are also particular statistical methods for analysis that can take advantage of this randomisation.</p>
<p>The model may be written <span id="eq-CRD"><span class="math display">\[
Y_{ij} = \mu _i + \varepsilon _{ij}~~~~(i=1,2,\ldots ,t; j=1,2,\ldots n_i)
\tag{4.1}\]</span></span> where <span class="math inline">\(n_i\)</span> is the size of the <span class="math inline">\(i\)</span>-th group, <span class="math inline">\(Y_{ij}\)</span> is the <span class="math inline">\(j\)</span>-th observation in the <span class="math inline">\(i\)</span>-th group, <span class="math inline">\(\mu _i\)</span> is the unknown mean for the <span class="math inline">\(i\)</span>-th treatment, and <span class="math inline">\(\varepsilon _{ij}\sim N(0,\sigma^2)\)</span> is random error.</p>
<p>Writing this model in matrix notation, we find that the parameters are orthogonal and we obtain (using the results in <a href="Review of linear models.html" class="quarto-xref"><span>Chapter 2</span></a>) <span class="math display">\[\begin{align}
\hat{\mu}_i=\overline{Y}_{i.}\\
\text{var}(\hat{\mu})_i=\frac{\sigma ^2}{n_i}
\end{align}\]</span> where <span class="math inline">\(\overline{Y}_{i.}\)</span> is the mean of the <span class="math inline">\(i\)</span>-th group.</p>
<p>From the design point of view, the main question here is how best to choose the sizes of the groups. Obviously, as ever, the larger the experiment, the more accurate the estimators will be, and so it is of more interest to look at the problem of choice of <span class="math inline">\(n_1, n_2, \ldots ,n_t\)</span> subject to a fixed total number of observations <span class="math inline">\(n\)</span> say.</p>
<p>If, for example, we adopt the <span class="math inline">\(D\)</span>-optimality criterion, then, noting that in this case <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> is the diagonal matrix with <span class="math inline">\(n_1, n_2, \ldots , n_t\)</span> down the diagonal, its determinant is <span class="math inline">\(n_1n_2\ldots n_t\)</span> and this is maximised subject to <span class="math inline">\(n_1+n_2+\ldots
+n_t=n\)</span> by taking <span class="math inline">\(n_1, n_2, \ldots , n_t\)</span> as nearly as possible equal to each other.</p>
<section id="estimating-treatment-differences" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="estimating-treatment-differences"><span class="header-section-number">4.2.1</span> Estimating treatment differences</h3>
<p>If there is a placebo, an alternative might be to aim to minimise the variance of the estimated treatment difference between each of the genuine treatments and the placebo. Suppose that each of the genuine treatments is administered to <span class="math inline">\(m\)</span> patients, and the placebo to the remaining <span class="math inline">\(n-(t-1)m\)</span> patients. If group 1 is the placebo group, then for <span class="math inline">\(i\neq 1\)</span> the effect of treatment <span class="math inline">\(i\)</span> is <span class="math inline">\(\mu_i - \mu_1\)</span>, and the variance of the estimator, as a function of <span class="math inline">\(m\)</span> is <span class="math display">\[
v(m):=var(\hat{\mu}_i -\hat{\mu}_1) = var(\hat{\mu}_i)+ var(\hat{\mu}_1) = \sigma ^2\left( \frac{1}{m} + \frac{1}{n-(t-1)m} \right).\]</span> Note that <span class="math inline">\(\hat{\mu}_i\)</span> and <span class="math inline">\(\hat{\mu}_1\)</span> are independent. We minimise this by treating <span class="math inline">\(m\)</span> as a continuous variable and using calculus. Leaving out the constant multiplicative factor <span class="math inline">\(\sigma
^2\)</span>, <span class="math display">\[\begin{align}
\frac{d}{dm} v(m)&amp;=-\frac{1}{m^2} + \frac{t-1}{(n-(t-1)m)^2}.\\
\frac{d^2}{dm^2}v(m)&amp;=\frac{2}{m^3}+\frac{2(t-1)^2}{(n-(t-1)m)^3}&gt;0.
\end{align}\]</span> Hence a minimum occurs when <span class="math inline">\((t-1)m^2 = (n-(t-1)m)^2\)</span>, and this is an equation which may be solved for <span class="math inline">\(m\)</span>. The solution will not necessarily be an integer, and so in practice it may have to be rounded up or down.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-crd" class="theorem example">
<p><span class="theorem-title"><strong>Example 4.1</strong></span> Let <span class="math inline">\(n=24\)</span> and <span class="math inline">\(t=3\)</span>. In this case the equation is<br>
<span class="math display">\[2m^2 = (24-2m)^2\]</span> leading to <span class="math display">\[m = \frac{24}{2+\sqrt{2}} \simeq 7.03\]</span> In practice we would take <span class="math inline">\(m=7\)</span>, and administer each of the two genuine treatments to seven patients, and the placebo to the remaining ten.</p>
</div>
</div>
</div>
</section>
</section>
<section id="reducing-variation-using-blocking" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="reducing-variation-using-blocking"><span class="header-section-number">4.3</span> Reducing variation using blocking</h2>
<p>In the general linear model <span class="math display">\[
Y = \mathbf{f}(\mathbf{x})^T\boldsymbol{\beta}+\varepsilon,
\]</span> the role of <span class="math inline">\(\varepsilon\)</span> is to account for any variation in the response variable that is not modelled (‘explained’) by the explanatory variables <span class="math inline">\(\mathbf{x}\)</span>. It may also account for measurement errors when observing the value of the response variable. The more unexplained variation there is, the greater the value of <span class="math inline">\(\sigma^2 = Var(\varepsilon)\)</span> is, which then increases the variance of the parameter estimates: <span class="math display">\[\text{Var}(\hat{\boldsymbol{\beta}}) =\sigma^2 (\mathbf{X}^T\mathbf{X})^{-1}\]</span></p>
<p>We can try to reduce variation by recording additional explanatory variables and incorporating them into the model, so that there is less ‘unexplained’ variation. For example, we could record additional physical characteristics of each patient, and include those in the model. It may be difficult to find a good model however; the relationship between these additional characteristics and the response variable may be complicated.</p>
<p>An alternative is to group the experimental subjects into <strong>blocks</strong> with similar characteristics, then simply incorporate a term in the model for the effect of each block. This can reduce unexplained variation, and hence reduce <span class="math inline">\(Var(\varepsilon)\)</span>, without the need to find a complicated model.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Choosing blocks
</div>
</div>
<div class="callout-body-container callout-body">
<p>Blocks (groups) should always be chosen so that we expect less variation within blocks than between blocks. All other things being equal, we would expect smaller differences between observed responses within a block, compared with differences between observed responses in different blocks.</p>
</div>
</div>
<p>Continuing the example of comparing <span class="math inline">\(t\)</span> different drugs, if the patients are grouped into <span class="math inline">\(b\)</span> blocks, a suitable model would be</p>
<p><span id="eq-RBD"><span class="math display">\[Y_{ijk} = \mu +\alpha_i + \tau_j+ \varepsilon _{ijk}, \tag{4.2}\]</span></span> where <span class="math inline">\(Y_{ijk}\)</span> is the response for the <span class="math inline">\(k\)</span>-th patient within block <span class="math inline">\(i\)</span> who was allocated to treatment <span class="math inline">\(j\)</span>. We have <span class="math inline">\(i=1,\ldots,b\)</span>; <span class="math inline">\(j=1,\ldots,t\)</span> and <span class="math inline">\(k=1,\ldots,n_{ij}\)</span>. Constraints are needed on the block and treatment parameters, for example <span class="math display">\[
\sum_{i=1}^b\alpha_i = \sum_{j=1}^t \tau_i = 0.
\]</span></p>
<p>We write that <span class="math inline">\(\varepsilon_{ijk}\sim N(0,\tilde{\sigma}^2)\)</span> and use the notation <span class="math inline">\(Var(\varepsilon_{ijk})=\tilde{\sigma}^2\)</span> to make clear that we expect the error term to have a different (smaller) variance than the model in <a href="#eq-CRD" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>, as we have explained additional variation in the response using the block effects.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>The purpose of blocking
</div>
</div>
<div class="callout-body-container callout-body">
<p>Typically, the block effects <span class="math inline">\(\alpha_1,\alpha_2,\ldots\)</span> are not of much interest: it’s the treatment effect parameters <span class="math inline">\(\tau_1,\tau_2,\ldots\)</span>that we are really interested in. The purpose of blocking is to reduce ‘unwanted variation’ (the variance of the error term), so that we can expect more accurate parameter estimates.</p>
</div>
</div>
</section>
<section id="sec-RBD" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sec-RBD"><span class="header-section-number">4.4</span> Randomised Block Designs (RBD)</h2>
<p>Having organised the experimental “units” (e.g.&nbsp;the patients in the study) into blocks, the remaining design question is how to allocate the units to treatments. If we use a <strong>randomised block design (RBD)</strong> then</p>
<ul>
<li>all of the blocks contain the same number of units;</li>
<li>each treatment is used the same number of times within each block.</li>
</ul>
<p>The simplest case is where each treatment is administered once within each block. In this case we can drop the <span class="math inline">\(k\)</span> subscript in <a href="#eq-RBD" class="quarto-xref">Equation&nbsp;<span>4.2</span></a> and write</p>
<p><span class="math display">\[Y_{ij} = \mu +\alpha_i + \tau_j+ \varepsilon _{ij},\]</span> with the same constraints and definitions as before.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-rbd" class="theorem example">
<p><span class="theorem-title"><strong>Example 4.2</strong></span> Suppose we have <span class="math inline">\(b=2\)</span> blocks and <span class="math inline">\(t=3\)</span> treatments. For an RBD, the model may be expressed as <span class="math display">\[
E\left( \begin{array}{c} Y_{11} \\ Y_{12} \\ Y_{13} \\ Y_{21} \\
Y_{22} \\ Y_{23} \end{array} \right) = \left( \begin{array}{cccc} 1 &amp; 1 &amp; 1 &amp; 0 \\ 1 &amp; 1 &amp; 0 &amp; 1 \\ 1 &amp; 1 &amp; -1 &amp; -1 \\ 1 &amp; -1 &amp; 1 &amp; 0 \\
1 &amp; -1 &amp; 0 &amp; 1 \\ 1 &amp; -1 &amp; -1 &amp; -1 \end{array} \right) \left(\begin{array}{c} \mu \\ \alpha _1 \\ \tau _1 \\ \tau _2 \end{array}\right)
\]</span> and in this case <span class="math display">\[\mathbf{X}^T\mathbf{X}=\left(\begin{array}{cccc} 6 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 6 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 4 &amp; 2 \\ 0 &amp; 0 &amp; 2 &amp; 4 \end{array} \right)
\text{ and }(\mathbf{X}^T\mathbf{X})^{-1}=\left(\begin{array}{rrrr}\frac{1}{6} &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; \frac{1}{6} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; \frac{1}{3} &amp;-\frac{1}{6} \\ 0 &amp; 0 &amp; -\frac{1}{6} &amp; \frac{1}{3} \end{array} \right).\]</span> Note that the three groups of parameters <span class="math inline">\(\{ \mu \} , \{ \alpha _i\}\)</span> and <span class="math inline">\(\{ \tau _j\}\)</span> are mutually orthogonal.</p>
</div>
</div>
</div>
<p>The symmetry of the RBD makes it relatively easy to analyse. If <span class="math inline">\(\overline{Y}_{..}\)</span> denotes the overall mean of the observations, <span class="math inline">\(\overline{Y}_{i.}\)</span> denotes the mean of block <span class="math inline">\(i\)</span> and <span class="math inline">\(\overline{Y}_{.j}\)</span> denotes the mean of treatment <span class="math inline">\(j\)</span>, then using the resultsfrom <a href="Review of linear models.html" class="quarto-xref"><span>Chapter 2</span></a> we obtain <span class="math display">\[\begin{align}
\hat{\mu}&amp;=\overline{Y}_{..} \\
\text{var}(\hat{\mu})&amp;=\frac{\tilde{\sigma} ^2}{bt}\\
\hat{\alpha}_i&amp;=\overline{Y}_{i.} - \overline{Y}_{..}\\
\text{var}(\hat{\alpha}_i)&amp;=\frac{\tilde{\sigma} ^2}{t}\left( 1 - \frac{1}{b} \right)\\
\text{cov}(\hat{\alpha}_i, \hat{\alpha }_{i^{\prime }})&amp;=-\frac{\tilde{\sigma} ^2}{bt}\text{ for }i\neq i^{\prime}\\
\hat{\tau }_j&amp;= \overline{Y}_{.j} - \overline{Y}_{..}\\
\text{var}(\hat{\tau }_j)=&amp;\frac{\tilde{\sigma}^2}{b}\left( 1 - \frac{1}{t} \right)\\
\text{cov}(\hat{\tau}_j, \hat{\tau }_{j^{\prime }})&amp;=-\frac{\tilde{\sigma}^2}{bt}\text{ for }j\neq j^{\prime}
\end{align}\]</span> and the three groups of parameters are mutually orthogonal and therefore independent.</p>
</section>
<section id="comparing-crds-and-rbds" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="comparing-crds-and-rbds"><span class="header-section-number">4.5</span> Comparing CRDs and RBDs</h2>
<p>Assuming the same overall sample size, which design is best for estimating a treatment effect? If we have <span class="math inline">\(b\)</span> blocks and <span class="math inline">\(m\)</span> treatments blocks in an RBD, the total sample size is <span class="math inline">\(m\times b\)</span>. In a <span class="math inline">\(D\)</span>-optimal CRD, each treatment would be used <span class="math inline">\(b\)</span> times to get the same total sample size.</p>
<p>The parameters in the models <a href="#eq-CRD" class="quarto-xref">Equation&nbsp;<span>4.1</span></a> and <a href="#eq-RBD" class="quarto-xref">Equation&nbsp;<span>4.2</span></a> have different interpretations, so we first define a quantity that has the same meaning for both designs/models.</p>
<p>We consider the expected difference in response between two treatments <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> if given to the same patient. For a CRD, this expected difference is <span class="math inline">\(\mu_p-\mu_q\)</span>, and the variance of the estimator is <span class="math display">\[ \mbox{Var}(\hat{\mu }_p-\hat{\mu }_{q}) = \frac{\sigma
^2}{b} + \frac{\sigma ^2}{b} = \frac{2\sigma ^2}{b},\]</span> as <span class="math inline">\(\hat{\mu }_p\)</span> and <span class="math inline">\(\hat{\mu }_{q}\)</span> are independent.</p>
<p>For an RBD, this expected difference is <span class="math inline">\(\tau_p-\tau_q\)</span> (the block effect cancels out) and the variance of the estimator is</p>
<p><span class="math display">\[\begin{align*}
\mbox{Var}(\hat{\tau }_p-\hat{\tau }_{q}) &amp; =
\mbox{Var}\hat{\tau }_p + \mbox{Var}\hat{\tau }_{q}
-2\mbox{Cov}(\hat{\tau }_p, \hat{\tau }_q) \\
&amp; =  \frac{2\tilde{\sigma}^2}{b}\left( 1-\frac{1}{t} \right) +
\frac{2\tilde{\sigma} ^2}{bt} \\
&amp; =  \frac{2\tilde{\sigma} ^2}{b} .
\end{align*}\]</span></p>
<p>So the estimator will have smaller variance if <span class="math inline">\(\tilde{\sigma}&lt;\sigma\)</span>. We would expect this to be the case, as the use of blocking should reduce the error variance. However, this benefit doesn’t come for free! For an RBD, we have fewer degrees of freedom for estimating the variance parameter, as we have more parameters in the model.</p>
</section>
<section id="tasks" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="tasks"><span class="header-section-number">4.6</span> Tasks</h2>
<p>Question 1 is a good revision exercise (you will have an exam formula sheet: you won’t need to memorise specific formulae). Question 2 is more for general interest (justifying a result in this chapter), but is not something you would be assessed on.</p>
<ol type="1">
<li><p>For the example in <a href="#exm-rbd" class="quarto-xref">Example&nbsp;<span>4.2</span></a>, use matrix notation and the relevant results for linear models to verify the results (estimators, variances, covariances) in <a href="#sec-RBD" class="quarto-xref"><span>Section 4.4</span></a>.</p></li>
<li><p>Show that, for given positive integers <span class="math inline">\(n&gt;t\)</span>, the product <span class="math inline">\(n_1n_2\ldots n_t\)</span> of positive integers subject to the constraint <span class="math inline">\(n_1+n_2+\ldots +n_t=n\)</span> is maximised by taking <span class="math inline">\(n_1, n_2, \ldots,n_t\)</span> as nearly as possible equal to each other, using the following approach. If two of the factors differ by more than two, say <span class="math inline">\(n_1\geq n_2+2\)</span>, then the product could be increased by replacing <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> by <span class="math inline">\(n_1-1\)</span> and <span class="math inline">\(n_2+1\)</span>; hence such a choice cannot be optimal.</p></li>
</ol>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>For the least squares estimates we compute <span class="math display">\[
\left(\begin{array}{c} \hat{\mu} \\ \hat{\alpha}_1 \\ \hat{\tau}_1 \\ \hat{\tau}_2 \end{array}\right) = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}
\]</span></li>
</ol>
<p>and the variance covariance matrix is obtained as</p>
<p><span class="math display">\[
\left(\begin{array}{cccc}var(\hat{\mu}) &amp; cov(\hat{\mu}, \hat{\alpha}_1) &amp; cov(\hat{\mu}, \hat{\tau}_1)  &amp; cov(\hat{\mu}, \hat{\tau}_2) \\
cov(\hat{\alpha}_1, \hat{\mu}) &amp; var(\hat{\alpha}_1) &amp; cov(\hat{\alpha}_1, \hat{\tau}_1)  &amp; cov(\hat{\alpha}_1, \hat{\tau}_2) \\
cov(\hat{\tau}_1, \hat{\mu}) &amp; cov(\hat{\tau}_1, \hat{\alpha}_1)  &amp; var(\hat{\tau}_1) &amp; cov(\hat{\tau}_1, \hat{\tau}_2)\\
cov(\hat{\tau}_2, \hat{\mu}) &amp; cov(\hat{\tau}_12 \hat{\alpha}_1)  &amp;   cov(\hat{\tau}_2, \hat{\tau}_1) &amp; var(\hat{\tau}_2)
\end{array}\right) = \sigma^2(\mathbf{X}^T\mathbf{X})^{-1}.
\]</span> Using the values given in the example for <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Y}\)</span>, we get the same parameter estimates and variances/covariances as stated.</p>
<ol start="2" type="1">
<li>If <span class="math inline">\(n_1\geq n_2+2\)</span> then <span class="math display">\[\begin{align}
(n_1-1)(n_2+1) &amp; =  n_1n_2 + n_1 - n_2 - 1 \\
&amp; \geq  n_1n_2 + 2 - 1 \\
&amp; =  n_1n_2 + 1 \\
&amp; &gt;  n_1n_2
\end{align}\]</span> and therefore, since the other factors are all positive, the whole product could be increased by replacing <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span> by <span class="math inline">\(n_1-1\)</span> and <span class="math inline">\(n_2+1\)</span>, and therefore the original choice cannot be optimal. It follows that the only candidates for optimality are those where no two numbers differ by more than <span class="math inline">\(1\)</span>, and so they are as nearly as possible equal to each other.</li>
</ol>
</div>
</div>
</div>
</section>
<section id="appendix---balanced-incomplete-block-designs" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="appendix---balanced-incomplete-block-designs"><span class="header-section-number">4.7</span> Appendix - Balanced Incomplete Block Designs</h2>
<p>This is included for reference only and is non-examinable.</p>
<p>In some cases, the size of a block (the number of experimental subjects in a block) may be too small to accommodate all the possible treatments. In this case, one option is to use a <strong>balanced incomplete block design</strong> (BIBD). The requirements of such a design are:</p>
<ul>
<li><p>all blocks are of the same size, with <span class="math inline">\(k\)</span> experimental subjects per block;</p></li>
<li><p>no treatment appears more than once within a block;</p></li>
<li><p>each treatment appears the same number <span class="math inline">\(r\)</span> times;</p></li>
<li><p>each pair of treatments appears in the same number <span class="math inline">\(\lambda\)</span> of blocks;</p></li>
</ul>
<p>If <span class="math inline">\(b\)</span> blocks are used in total, the total number of observations of <span class="math inline">\(bk\)</span>. If there are <span class="math inline">\(t\)</span> treatments, then we must have</p>
<p><span class="math display">\[
bk = rt \quad \mbox{ and } r(k-1) = \lambda(t-1),
\]</span> which puts constraints on the choices of <span class="math inline">\(b, r\)</span> and <span class="math inline">\(\lambda\)</span> for which BIBDs exist.</p>
<p>R packages are available for generating such designs, e.g.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose we have four treatments, </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a BIBD with block sizes of k = 3 observations per block</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and r = 6 observations for each treatment</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>outdesign <span class="ot">&lt;-</span> <span class="fu">design.bib</span>(treatments, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">r =</span> <span class="dv">6</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Parameters BIB
==============
Lambda     : 4
treatmeans : 4
Block size : 3
Blocks     : 8
Replication: 6 

Efficiency factor 0.8888889 

&lt;&lt;&lt; Book &gt;&gt;&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(outdesign<span class="sc">$</span>sketch)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] "C"  "A"  "B" 
[2,] "D"  "B"  "C" 
[3,] "B"  "D"  "A" 
[4,] "D"  "A"  "C" 
[5,] "A"  "C"  "D" 
[6,] "D"  "B"  "C" 
[7,] "B"  "A"  "C" 
[8,] "B"  "A"  "D" </code></pre>
</div>
</div>
<p>The function will report if a BIBD is not possible for the choice of <span class="math inline">\(t,k, r\)</span>. e.g, for <span class="math inline">\(r=4\)</span> we should have 16 observations in total, but this is not divisible by the block size of <span class="math inline">\(k=3\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">design.bib</span>(treatments, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">r =</span> <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Change r by  3, 6, 9, 12, 15, 18 ...</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Optimality.html" class="pagination-link" aria-label="Optimality criteria">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality criteria</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Qualitative-multiple factors.html" class="pagination-link" aria-label="Latin Square designs">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Latin Square designs</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>