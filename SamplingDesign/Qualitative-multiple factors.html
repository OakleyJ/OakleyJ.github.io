<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Latin Square designs – MPS4101 Sampling Theory and Design of Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Factorial designs.html" rel="next">
<link href="./Qualitative-single factor.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-27c261d06b905028a18691de25d09dde.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction to experimental design.html">Part I: Experimental Design</a></li><li class="breadcrumb-item"><a href="./Qualitative-multiple factors.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Latin Square designs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MPS4101 Sampling Theory and Design of Experiments</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructions</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Experimental Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to experimental design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Experimental Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Review of linear models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A review of linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Optimality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality criteria</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-single factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Qualitative explanatory variables and blocking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-multiple factors.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Latin Square designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Factorial designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Factorial designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Continuous and exact designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Continuous and exact designs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Sampling Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Simple random sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Simple Random Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Sample sizes and confidence intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Confidence intervals and sample sizes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Stratified sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Stratified Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Population size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Estimating a Population Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Practicalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Reliability of sample surveys</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: self-study topics for MPS4101</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tailor-made designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Modifying designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Cluster sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Cluster Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction-computer-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction to computer experiments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Uncertainty-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Uncertainty analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Sensitivity-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Sensitivity analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#latin-square-designs-for-three-factors" id="toc-latin-square-designs-for-three-factors" class="nav-link active" data-scroll-target="#latin-square-designs-for-three-factors"><span class="header-section-number">5.1</span> Latin square designs for three factors</a></li>
  <li><a href="#models-and-parameter-orthogonality" id="toc-models-and-parameter-orthogonality" class="nav-link" data-scroll-target="#models-and-parameter-orthogonality"><span class="header-section-number">5.2</span> Models and parameter orthogonality</a>
  <ul class="collapse">
  <li><a href="#sec-orthoLS" id="toc-sec-orthoLS" class="nav-link" data-scroll-target="#sec-orthoLS"><span class="header-section-number">5.2.1</span> Orthogonal Latin squares</a></li>
  </ul></li>
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks"><span class="header-section-number">5.3</span> Tasks</a></li>
  <li><a href="#appendix-existence-of-orthogonal-latin-squares" id="toc-appendix-existence-of-orthogonal-latin-squares" class="nav-link" data-scroll-target="#appendix-existence-of-orthogonal-latin-squares"><span class="header-section-number">5.4</span> Appendix: existence of orthogonal Latin squares</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction to experimental design.html">Part I: Experimental Design</a></li><li class="breadcrumb-item"><a href="./Qualitative-multiple factors.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Latin Square designs</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Latin Square designs</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Aims for this chapter
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this chapter we</p>
<ul>
<li><p>study an efficient design (the Latin square) that can be used to investigate the effects of multiple factors on a response;</p></li>
<li><p>consider the linear model that can be fitted to data from Latin square designs.</p></li>
</ul>
</div>
</div>
<section id="latin-square-designs-for-three-factors" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="latin-square-designs-for-three-factors"><span class="header-section-number">5.1</span> Latin square designs for three factors</h2>
<p>The basic Latin square design is intended for three different qualitative explanatory variables (factors), each operating at the same number <span class="math inline">\(k\)</span> of levels. If we wanted to try each combination of factor levels, we would require <span class="math inline">\(k^3\)</span> observations. A Latin Square design estimates the effects of each factor using using only <span class="math inline">\(k^2\)</span> observations:</p>
<ul>
<li><p>We represent the <span class="math inline">\(k^2\)</span> design points using a <span class="math inline">\(k\times k\)</span> array;</p></li>
<li><p>the row index and column index represent the levels of two of the factors;</p></li>
<li><p>the level of the third factor is specified for each of the <span class="math inline">\(k^2\)</span> elements of the array, such that each level of this factor appears exactly once in each row and each column</p></li>
</ul>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-latin" class="theorem example">
<p><span class="theorem-title"><strong>Example 5.1</strong></span> An experiment is designed to investigate how resistant to different materials are to wear: the response variable is the weight loss is a sample of the material following a period of motion on an abrasive surface. Four separate tests are conducted, and for each test, four samples are tested at once, with samples attached to different positions in the machine. The three factors are</p>
<ol type="1">
<li><p>Material type (A, B, C, D)</p></li>
<li><p>Position of the material in the machine (1, 2, 3, 4)</p></li>
<li><p>Test number (1, 2, 3, 4)</p></li>
</ol>
<p>In this case, material type is the main factor of interest; “position” and “test number” could be thought of as blocking factors. A Latin Square design is as follows:</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td></td>
<td style="text-align: center;"><em>Position</em></td>
<td style="text-align: center;"><em>in</em></td>
<td style="text-align: center;"><em>machine</em></td>
<td></td>
</tr>
<tr class="even">
<td><em>Test</em></td>
<td style="text-align: center;"><em>1</em></td>
<td style="text-align: center;"><em>2</em></td>
<td style="text-align: center;"><em>3</em></td>
<td><em>4</em></td>
</tr>
<tr class="odd">
<td><em>1</em></td>
<td style="text-align: center;"><em>A</em></td>
<td style="text-align: center;"><em>B</em></td>
<td style="text-align: center;"><em>D</em></td>
<td><em>C</em></td>
</tr>
<tr class="even">
<td><em>2</em></td>
<td style="text-align: center;"><em>D</em></td>
<td style="text-align: center;"><em>C</em></td>
<td style="text-align: center;"><em>A</em></td>
<td><em>B</em></td>
</tr>
<tr class="odd">
<td><em>3</em></td>
<td style="text-align: center;"><em>C</em></td>
<td style="text-align: center;"><em>D</em></td>
<td style="text-align: center;"><em>B</em></td>
<td><em>A</em></td>
</tr>
<tr class="even">
<td><em>4</em></td>
<td style="text-align: center;"><em>B</em></td>
<td style="text-align: center;"><em>A</em></td>
<td style="text-align: center;"><em>C</em></td>
<td><em>D</em></td>
</tr>
</tbody>
</table>
<p>where the choice of material is indicated by the appropriate letter. We refer to the three factors as the “row factor” (Test), the “column factor” (Position) and “treatment factor” (material).</p>
</div>
</div>
</div>
</section>
<section id="models-and-parameter-orthogonality" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="models-and-parameter-orthogonality"><span class="header-section-number">5.2</span> Models and parameter orthogonality</h2>
<p>The model to be fitted to a Latin square design may be written <span class="math display">\[Y_{ij} = \mu + \alpha _i + \beta_j + \tau _{\kappa (i,j)} + \varepsilon _{ij}\]</span> where</p>
<ul>
<li><span class="math inline">\(Y_{ij}\)</span> is the observation in row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span>;</li>
<li><span class="math inline">\(\{ \alpha _i\}\)</span> and <span class="math inline">\(\{ \beta_j\}\)</span> are the parameters for row and column effects respectively</li>
<li><span class="math inline">\(\{ \tau _{\kappa }\}\)</span> are parameters for treatment effects, with <span class="math inline">\(\kappa (i,j)\)</span> indicating the treatment which is applied in row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span></li>
</ul>
<p>We choose parameter constraints <span id="eq-LatinConstraints"><span class="math display">\[
\sum_{i=1}^k \alpha_i = \sum_{j=1}^k \beta_j = \sum_{\kappa = 1 }^k\tau _{\kappa }=0.
\tag{5.1}\]</span></span></p>
<p>To obtain least squares parameter estimators and check for orthogonality, we should write the model in matrix notation and inspect <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> etc. This is left as a task at the end of this chapter, but we will state some results here.</p>
<p>The groups of parameters <span class="math inline">\(\{\mu\}, \{\alpha_i\}, \{\beta_j\},\{tau_{\kappa}\}\)</span> are all mutually orthogonal, and least square estimators are</p>
<p><span class="math display">\[\begin{align}
\hat{\mu}&amp; = \frac{1}{k^2}\sum_{i=1}^k\sum_{j=1}^k Y_{ij},\\
\hat{\alpha}_i&amp; = \frac{1}{k}\sum_{j=1}^k Y_{ij} - \hat{\mu},\\
\hat{\beta}_j&amp; = \frac{1}{k}\sum_{i=1}^k Y_{ij}- \hat{\mu},\\
\hat{\tau}_\kappa&amp; = \frac{1}{k}\sum_{i, j: \kappa(i,j)=\kappa}^k Y_{ij}.
\end{align}\]</span></p>
<p>Given the Latin square design and the parameter constraints in <a href="#eq-LatinConstraints" class="quarto-xref">Equation&nbsp;<span>5.1</span></a>, we can understand why these are the estimators and why the parameters are orthogonal. Consider again <a href="#exm-latin" class="quarto-xref">Example&nbsp;<span>5.1</span></a>. If we inspect the estimator for <span class="math inline">\(\hat{\alpha}_1\)</span>, the ‘row 1 parameter effect’, we see that <span class="math display">\[
E\left(\sum_{j=1}^k Y_{1j}\right) = 4\alpha_1 +\sum_{j=1}^4\beta_j + \sum_{\kappa=1}^4\tau_\kappa+ 4\mu = 4\alpha_1 + 4\mu
\]</span> as all the column and treatment effects cancel out given the sum to zero constraints. Hence dividing the sum by 4 and subtracting <span class="math inline">\(\hat{\mu}\)</span> gives an unbiased estimator of <span class="math inline">\(\alpha_1\)</span>.</p>
<p>We can also understand why, for example, row effects and treatment effects are orthogonal. The row effect estimators are based on differences between the means of the observations in each row. But in each row, we’ve ensured each treatment is used once, and the treatment effects are specified to sum to zero: they cancel out within each row. So it makes sense that the row effect estimators would not depend on the treatment effect estimators.</p>
<section id="sec-orthoLS" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="sec-orthoLS"><span class="header-section-number">5.2.1</span> Orthogonal Latin squares</h3>
<p>We can incorporate one additional factor, also with <span class="math inline">\(k\)</span> levels, by superimposing a new Latin square on the existing one, such as the one represented by the Greek letters in the following diagram:</p>
<div class="center">
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: center;">A<span class="math inline">\(\alpha\)</span></td>
<td style="text-align: center;">B<span class="math inline">\(\beta\)</span></td>
<td style="text-align: center;">D<span class="math inline">\(\gamma\)</span></td>
<td style="text-align: center;">C<span class="math inline">\(\delta\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">D<span class="math inline">\(\beta\)</span></td>
<td style="text-align: center;">C<span class="math inline">\(\alpha\)</span></td>
<td style="text-align: center;">A<span class="math inline">\(\delta\)</span></td>
<td style="text-align: center;">B<span class="math inline">\(\gamma\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">C<span class="math inline">\(\gamma\)</span></td>
<td style="text-align: center;">D<span class="math inline">\(\delta\)</span></td>
<td style="text-align: center;">B<span class="math inline">\(\alpha\)</span></td>
<td style="text-align: center;">A<span class="math inline">\(\beta\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">B<span class="math inline">\(\delta\)</span></td>
<td style="text-align: center;">A<span class="math inline">\(\gamma\)</span></td>
<td style="text-align: center;">C<span class="math inline">\(\beta\)</span></td>
<td style="text-align: center;">D<span class="math inline">\(\alpha\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>then it may happen, as it does above, that each combination of levels of the two treatment factors appears once in the diagram. In this case, we have a <strong>Graeco-Latin square</strong>, and the two Latin square designs, represented by the Latin letters and the Greek letters, are called <strong>orthogonal Latin squares</strong>. The parameters for the new factor are orthogonal to all the others.</p>
</section>
</section>
<section id="tasks" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="tasks"><span class="header-section-number">5.3</span> Tasks</h2>
<ol type="1">
<li><p>Write down the <span class="math inline">\(16\)</span> by <span class="math inline">\(10\)</span> design matrix in <a href="#exm-latin" class="quarto-xref">Example&nbsp;<span>5.1</span></a>.</p></li>
<li><p>Hence show that <span class="math inline">\(\tau_A\)</span> is orthogonal to all the non-treatment parameters but not the other treatment parameters.</p></li>
<li><p>Show that <span class="math inline">\(\text{var}(\hat{\tau}_A)= \frac{3 \sigma^2}{16}\)</span> where <span class="math inline">\(\text{var}\left(Y_{ij}\right)=\sigma^2\)</span>.</p></li>
<li><p>For the example in <a href="#sec-orthoLS" class="quarto-xref"><span>Section 5.2.1</span></a>, what are the dimensions of the design matrix?</p></li>
</ol>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>I have added the parameters in the top row of the matrix to make it clearer but these should obviously not be there. I have also added additional horizontal and vertical lines to make it easier to read. <span class="math display">\[
\left(
\begin{array}{c|ccc|ccc|ccc}
\mu &amp; \alpha_1 &amp; \alpha_2 &amp; \alpha_3 &amp; \beta_1 &amp; \beta_2 &amp; \beta_3 &amp; \tau_A &amp; \tau_B &amp; \tau_C \\
\hline
1&amp; 1&amp; 0&amp; 0&amp; 1&amp; 0&amp; 0&amp; 1&amp; 0&amp; 0\\
1&amp; 1&amp; 0&amp; 0&amp; 0&amp; 1&amp; 0&amp; 0&amp; 1&amp; 0\\
1&amp; 1&amp; 0&amp; 0&amp; 0&amp; 0&amp; 1&amp;-1&amp;-1&amp;-1\\
1&amp; 1&amp; 0&amp; 0&amp;-1&amp;-1&amp;-1&amp; 0&amp; 0&amp; 1\\
\hline
1&amp; 0&amp; 1&amp; 0&amp; 1&amp; 0&amp; 0&amp;-1&amp;-1&amp;-1\\
1&amp; 0&amp; 1&amp; 0&amp; 0&amp; 1&amp; 0&amp; 0&amp; 0&amp; 1\\
1&amp; 0&amp; 1&amp; 0&amp; 0&amp; 0&amp; 1&amp; 1&amp; 0&amp; 0\\
1&amp; 0&amp; 1&amp; 0&amp;-1&amp;-1&amp;-1&amp; 0&amp; 1&amp; 0\\
\hline
1&amp; 0&amp; 0&amp; 1&amp; 1&amp; 0&amp; 0&amp; 0&amp; 0&amp; 1\\
1&amp; 0&amp; 0&amp; 1&amp; 0&amp; 1&amp; 0&amp;-1&amp;-1&amp;-1\\
1&amp; 0&amp; 0&amp; 1&amp; 0&amp; 0&amp; 1&amp; 0&amp; 1&amp; 0\\
1&amp; 0&amp; 0&amp; 1&amp;-1&amp;-1&amp;-1&amp; 1&amp; 0&amp; 0\\
\hline
1&amp;-1&amp;-1&amp;-1&amp; 1&amp; 0&amp; 0&amp; 0&amp; 1&amp; 0\\
1&amp;-1&amp;-1&amp;-1&amp; 0&amp; 1&amp; 0&amp; 1&amp; 0&amp; 0\\
1&amp;-1&amp;-1&amp;-1&amp; 0&amp; 0&amp; 1&amp; 0&amp; 0&amp; 1\\
1&amp;-1&amp;-1&amp;-1&amp;-1&amp;-1&amp;-1&amp;-1&amp;-1&amp;-1\\
\end{array}
\right)
\]</span></p></li>
<li><p>Calculating the column products shows that <span class="math inline">\(\tau_A\)</span> is orthogonal to all the parameters except <span class="math inline">\(\tau_B\)</span> and <span class="math inline">\(\tau_C\)</span>.</p></li>
<li><p>Let <span class="math inline">\(Q\)</span> be the set of <span class="math inline">\((i,j)\)</span> values given by <span class="math inline">\(\left\{ (1,1), (2,3), (3,4), (4,2) \right\}\)</span> <span class="math display">\[\begin{align}
\hat{\tau}_A &amp;= \overline{Y}_{(\kappa)} - \overline{Y}_{..}\\
&amp;= \frac{Y_{11}+Y_{23}+Y_{34}+Y_{42}}{4} - \frac{\sum_{i=1}^4 \sum_{j=1}^4 Y_{ij} }{16}\\
&amp;= \frac{3}{16}\left( Y_{11}+Y_{23}+Y_{34}+Y_{42}\right) - \frac{\sum_{(i,j) \not\in Q} Y_{ij}}{16}\\
\end{align}\]</span> Using the fact that <span class="math inline">\(Y_{i,j}\)</span> is independent of <span class="math inline">\(Y_{i^\prime, j^\prime}\)</span> for <span class="math inline">\((i,j) \neq (i^\prime, j^\prime)\)</span> it follows that <span class="math display">\[\begin{align}
var({\hat{\tau}_A}) &amp;= \left(\frac{3}{16}\right)^2 4\sigma^2 + \left(\frac{1}{16}\right)^2 12\sigma^2\\
&amp;= \frac{3\sigma^2}{16}
\end{align}\]</span></p></li>
<li><p>The design matrix would be <span class="math inline">\(16\times 13\)</span>: there are 16 observations, and 13 parameters:</p></li>
</ol>
<ul>
<li>the constant <span class="math inline">\(\mu\)</span></li>
<li>three parameters for row effects</li>
<li>three parameters for column effects</li>
<li>three parameters for the treatment factor with levels represented by <span class="math inline">\(A, B, C, D\)</span></li>
<li>three parameters for the additional treatment factor with levels represented by <span class="math inline">\(\alpha,\beta,\gamma,\delta\)</span></li>
</ul>
</div>
</div>
</div>
</section>
<section id="appendix-existence-of-orthogonal-latin-squares" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="appendix-existence-of-orthogonal-latin-squares"><span class="header-section-number">5.4</span> Appendix: existence of orthogonal Latin squares</h2>
<p>The following is reference material and will not be examined.</p>
<p>The question whether orthogonal Latin squares exist, and, if so, how many, for a given value of <span class="math inline">\(k\)</span>, is of considerable combinatorial interest in its own right, and gets input from the <em>algebraic theory of finite fields</em>. A finite field is a finite set including <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> and in which addition, multiplication, subtraction and division by non-zero elements are possible and satisfy the usual rules. The simplest example of a finite field is “integers modulo <span class="math inline">\(p\)</span>”, where <span class="math inline">\(p\)</span> is a prime number. This is a field with <span class="math inline">\(p\)</span> elements, <span class="math inline">\(\{ 0,1,\ldots ,p-1\}\)</span> say. However, the theory states that a finite field with <span class="math inline">\(k\)</span> elements exists if and only if <span class="math inline">\(k\)</span> is of the form <span class="math inline">\(p^r\)</span>, where <span class="math inline">\(p\)</span> is prime and <span class="math inline">\(r\)</span> is any positive integer. This is relevant to the following theorem.</p>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Theorem
</div>
</div>
<div class="callout-body-container callout-body">
<div id="thm-latin" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5.1</strong></span> If <span class="math inline">\(k\)</span> is of the form <span class="math inline">\(p^r\)</span>, where <span class="math inline">\(p\)</span> is a prime number and <span class="math inline">\(r\)</span> is a positive integer, then there exists a complete set of <span class="math inline">\(k-1\)</span> mutually orthogonal <span class="math inline">\(k\times k\)</span> Latin squares.</p>
</div>
</div>
</div>
<p>By a <em>complete set</em> we mean that no further additions to the set are possible. We shall not prove this in general, but illustrate it by the construction of such a complete set in the case <span class="math inline">\(k=5\)</span>. Working in arithmetic modulo <span class="math inline">\(5\)</span>, suppose we label the rows and columns of any square, by the elements of the finite field: in this case <span class="math inline">\(0,1,2,3,4\)</span>. In the first square, in position <span class="math inline">\((i,j)\)</span> we place the value of <span class="math inline">\(i+j\)</span>; in the second square, the value of <span class="math inline">\(i+2j\)</span>; in the third square, the value of <span class="math inline">\(i+3j\)</span>; and in the fourth square, the value of <span class="math inline">\(i+4j\)</span>. (In general, if we denote the elements of the field by <span class="math inline">\(0,1,a,b,c\)</span> (as all finite fields must include 0 and 1), we actually want the values of <span class="math inline">\(i+aj\)</span>, <span class="math inline">\(i+bj\)</span> and <span class="math inline">\(i+cj\)</span> in the second, third and fourth squares). Then we get the following.</p>
<p><span class="math inline">\(i+j\)</span> <span class="math display">\[\begin{array}
{|ccccc|} \hline  0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ 1 &amp; 2 &amp;  3 &amp; 4 &amp; 0 \\ 2 &amp; 3 &amp; 4 &amp; 0 &amp; 1 \\ 3 &amp; 4 &amp; 0 &amp; 1 &amp; 2 \\ 4 &amp; 0 &amp; 1 &amp; 2 &amp; 3 \\ \hline
\end{array}\]</span></p>
<p><span class="math inline">\(i+2j\)</span> <span class="math display">\[\begin{array}{|ccccc|} \hline 0 &amp; 2 &amp; 4 &amp; 1 &amp; 3 \\ 1 &amp; 3 &amp; 0 &amp; 2 &amp; 4 \\ 2 &amp; 4 &amp; 1 &amp; 3 &amp; 0 \\ 3 &amp; 0 &amp; 2 &amp; 4 &amp; 1 \\ 4 &amp; 1 &amp; 3 &amp; 0 &amp; 2 \\ \hline \end{array}\]</span></p>
<p><span class="math inline">\(i+3j\)</span> <span class="math display">\[\begin{array}{|ccccc|} \hline 0 &amp; 3 &amp; 1 &amp; 4 &amp; 2 \\ 1 &amp; 4 &amp; 2 &amp; 0 &amp; 3 \\ 2 &amp; 0 &amp; 3 &amp; 1 &amp; 4 \\ 3 &amp; 1 &amp; 4 &amp; 2 &amp; 0 \\ 4 &amp; 2 &amp; 0 &amp; 3 &amp; 1 \\ \hline
\end{array}\]</span></p>
<p><span class="math inline">\(i+4j\)</span> <span class="math display">\[\begin{array}{|ccccc|} \hline 0 &amp; 4 &amp; 3 &amp; 2 &amp; 1 \\ 1 &amp; 0 &amp; 4 &amp; 3 &amp; 2 \\ 2 &amp; 1 &amp; 0 &amp; 4 &amp; 3 \\ 3 &amp; 2 &amp; 1 &amp; 0 &amp; 4 \\ 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 \\ \hline \end{array}\]</span> Clearly any two of these squares are orthogonal. This construction works because integers modulo <span class="math inline">\(5\)</span> constitute a finite field.</p>
<p>The smallest value of <span class="math inline">\(k\)</span> which is <strong>not</strong> of the form <span class="math inline">\(p^r\)</span> is <span class="math inline">\(k=6\)</span>. It has been shown that there do not even exist <strong>two</strong> <span class="math inline">\(6\times 6\)</span> Latin squares which are orthogonal to each other. However, for <span class="math inline">\(k=10\)</span> there do exist a complete set of orthogonal Latin squares, and so the condition that <span class="math inline">\(k\)</span> takes the form <span class="math inline">\(p^r\)</span> is not a <strong>necessary</strong> condition.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Qualitative-single factor.html" class="pagination-link" aria-label="Qualitative explanatory variables and blocking">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Qualitative explanatory variables and blocking</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Factorial designs.html" class="pagination-link" aria-label="Factorial designs">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Factorial designs</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>