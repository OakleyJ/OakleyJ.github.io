<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>A Second Course on Linear Models - 9&nbsp; Model Selection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./matrixAlgebra.html" rel="next">
<link href="./transformations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./modelSelection.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Model Selection</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">A Second Course on Linear Models</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basicconcepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Basic concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parameterestimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Parameter estimation for linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qualitative.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Qualitative independent variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fitting-in-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fitting a linear model and making predictions in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hypothesisTesting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Hypothesis testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cautionaryTales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Cautionary tales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Checking model assumptions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modelSelection.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Model Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrixAlgebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Matrix algebra essentials</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./randomVectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Random vectors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariateNormal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">The multivariate normal distribution</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#inference-versus-prediction" id="toc-inference-versus-prediction" class="nav-link active" data-scroll-target="#inference-versus-prediction"><span class="header-section-number">9.1</span> Inference versus prediction</a></li>
  <li><a href="#bias-variance-decomposition-and-trade-offs" id="toc-bias-variance-decomposition-and-trade-offs" class="nav-link" data-scroll-target="#bias-variance-decomposition-and-trade-offs"><span class="header-section-number">9.2</span> Bias-variance decomposition and trade-offs</a></li>
  <li><a href="#measuring-goodness-of-fit-and-penalising-for-model-complexity" id="toc-measuring-goodness-of-fit-and-penalising-for-model-complexity" class="nav-link" data-scroll-target="#measuring-goodness-of-fit-and-penalising-for-model-complexity"><span class="header-section-number">9.3</span> Measuring goodness of fit and penalising for model complexity</a>
  <ul class="collapse">
  <li><a href="#the-adjusted-r2-statistic" id="toc-the-adjusted-r2-statistic" class="nav-link" data-scroll-target="#the-adjusted-r2-statistic"><span class="header-section-number">9.3.1</span> The adjusted <span class="math inline">\(R^2\)</span> statistic</a></li>
  <li><a href="#aic-and-bic" id="toc-aic-and-bic" class="nav-link" data-scroll-target="#aic-and-bic"><span class="header-section-number">9.3.2</span> AIC and BIC</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">9.3.3</span> Example</a></li>
  </ul></li>
  <li><a href="#constrainedpenalised-regression" id="toc-constrainedpenalised-regression" class="nav-link" data-scroll-target="#constrainedpenalised-regression"><span class="header-section-number">9.4</span> Constrained/penalised regression</a>
  <ul class="collapse">
  <li><a href="#best-subset-selection" id="toc-best-subset-selection" class="nav-link" data-scroll-target="#best-subset-selection"><span class="header-section-number">9.4.1</span> Best subset selection</a></li>
  <li><a href="#ridge-regression" id="toc-ridge-regression" class="nav-link" data-scroll-target="#ridge-regression"><span class="header-section-number">9.4.2</span> Ridge regression</a></li>
  <li><a href="#lasso" id="toc-lasso" class="nav-link" data-scroll-target="#lasso"><span class="header-section-number">9.4.3</span> Lasso</a></li>
  <li><a href="#parameter-choices" id="toc-parameter-choices" class="nav-link" data-scroll-target="#parameter-choices"><span class="header-section-number">9.4.4</span> Parameter choices</a></li>
  </ul></li>
  <li><a href="#chapter-appendix" id="toc-chapter-appendix" class="nav-link" data-scroll-target="#chapter-appendix"><span class="header-section-number">9.5</span> Chapter appendix</a>
  <ul class="collapse">
  <li><a href="#best-subset-selection-with-leaps" id="toc-best-subset-selection-with-leaps" class="nav-link" data-scroll-target="#best-subset-selection-with-leaps"><span class="header-section-number">9.5.1</span> Best subset selection with <code>leaps</code></a></li>
  <li><a href="#lasso-and-ridge-regression-with-glmnet" id="toc-lasso-and-ridge-regression-with-glmnet" class="nav-link" data-scroll-target="#lasso-and-ridge-regression-with-glmnet"><span class="header-section-number">9.5.2</span> LASSO and Ridge Regression with <code>glmnet</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Model Selection</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="inference-versus-prediction" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="inference-versus-prediction"><span class="header-section-number">9.1</span> Inference versus prediction</h2>
<p>We have used hypothesis testing for <em>inference</em>: learning about the process that generated the data, in particular, whether or not particular variables are associated with the dependent variable of interest.</p>
<p>A related, but different problem is to find the best statistical model we can for <em>predicting</em> the value of the dependent variable on any occasion. Rather than understanding the data we have, the interest is in how the model would perform in predicting <em>new</em> data. Hence for inference, we can do our analysis on the whole dataset, but for prediction, if we want to evaluate the performance of our model, we might need to hold back some of the data for testing.</p>
<p>Hypothesis testing can still play a role in the prediction problem: if we find a particular term in a model is not significantly different from zero, we wouldn’t expect it to be useful for the prediction task, but hypothesis testing cannot compare non-nested models</p>
<p>For example, suppose we want to know which of the two following models is best for predicting the <span class="math inline">\(Y\)</span> variable: <span class="math display">\[
Y_i = \beta_0 + \beta_1 x_i+\varepsilon_i,
\]</span> or <span class="math display">\[
Y_i = \alpha_0 + \alpha_1 z_i+\delta_i,
\]</span> We might want to choose one if there is a cost to obtaining each of the <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> variables, and we want to minimise the cost. The models are not nested, so we cannot make the choice using a hypothesis test.</p>
<p>With large numbers of independent variables, it is more likely we would want to compare non-nested models. There are also computational issues if there is a large number of candidate models to compare, and if we have <span class="math inline">\(p\)</span> candidate regressor variables and <span class="math inline">\(n\)</span> observations, with <span class="math inline">\(n&lt;p\)</span>, we may not even be able to fit a model with all regressor variables included.</p>
</section>
<section id="bias-variance-decomposition-and-trade-offs" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="bias-variance-decomposition-and-trade-offs"><span class="header-section-number">9.2</span> Bias-variance decomposition and trade-offs</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is possible for a more complicated model to give worse predictions than a simpler one!</p>
</div>
</div>
<p>Consider predicting some future observation <span class="math inline">\(Y^*\)</span> given <span class="math inline">\(\boldsymbol{x}^*\)</span>, which we write as <span class="math display">\[
Y^* = f(\boldsymbol{x}^*) + \varepsilon^*,
\]</span> where <span class="math inline">\(\mathbb{E}(\varepsilon^*)=0\)</span> and <span class="math inline">\(Var(\varepsilon^*) = 0\)</span>. We predict <span class="math inline">\(Y^*\)</span> with <span class="math inline">\(\hat{f}(\boldsymbol{x}^*)\)</span>, where <span class="math inline">\(\hat{f}(\boldsymbol{x}^*)\)</span> is our estimate of <span class="math inline">\(f(\boldsymbol{x}^*)\)</span>, and we write <span class="math inline">\(\hat{f}:=\hat{f}(\boldsymbol{x}^*)\)</span> and <span class="math inline">\(f:=f(\boldsymbol{x}^*)\)</span> for short. For a linear model, we would normally use least squares to obtain <span class="math inline">\(\hat{f}\)</span>.</p>
<p><em>Before</em> observing the data for which we will obtain <span class="math inline">\(\hat{f}\)</span>, we consider the expected squared error of our estimator:</p>
<p><span class="math display">\[
\mathbb{E}((Y^*-\hat{f})^2) = \mathbb{E}((f+\varepsilon^*-\hat{f})^2).
\]</span> The expectation is with respect to both the random error <span class="math inline">\(\varepsilon^*\)</span> and the random data used to obtain <span class="math inline">\(\hat{f}\)</span>. We now define <span class="math display">\[
\mu_f:=\mathbb{E}(\hat{f})
\]</span> to be the expected value of the estimator <span class="math inline">\(\hat{f}\)</span>, so that if <span class="math inline">\(\mu_f - f\)</span> is the bias of the estimator <span class="math inline">\(\hat{f}\)</span>. Then <span class="math display">\[\begin{align}
\mathbb{E}((f+\varepsilon^* - \hat{f})^2)&amp; = \\
&amp; = \mathbb{E}((\varepsilon^* + f-\mu_f+ \mu_f- \hat{f})^2)\\
&amp; = \mathbb{E}({\varepsilon^*}*^2) + \mathbb{E}((f-\mu_f))^2) + \mathbb{E}((\hat{f}-\mu_f)^2)\\
&amp;= \sigma^2 + \mbox{bias}^2 + Var(\hat{f}).
\end{align}\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To derive this result, note that (1) the random terms in <span class="math inline">\((f+\varepsilon^* - \hat{f})^2\)</span> are <span class="math inline">\(\varepsilon^*\)</span> and <span class="math inline">\(\hat{f}\)</span>, (2) that <span class="math inline">\(\varepsilon^*\)</span> is independent of <span class="math inline">\(\hat{f}\)</span> and has expectation 0, and (3), that <span class="math display">\[
\mathbb{E}((f-\mu_f)(\mu_f- \hat{f})) = (f-\mu_f)(\mu_f- \mathbb{E}(\hat{f}))  = 0,
\]</span> as <span class="math inline">\(\mu_f:=\mathbb{E}(\hat{f})\)</span>.</p>
</div>
</div>
<p>Hence there are three terms that contribute to the expected squared prediction error for a future observation:</p>
<ol type="1">
<li><p>the (‘irreducible’) random error term corresponding to that observation;</p></li>
<li><p>the bias (squared) in estimating <span class="math inline">\(f\)</span> with <span class="math inline">\(\hat{f}\)</span>;</p></li>
<li><p>the variance of the estimator <span class="math inline">\(\hat{f}\)</span>.</p></li>
</ol>
<p>More complex models tend to have <em>smaller</em> bias, but <em>larger</em> variance: smaller bias because the additional complexity means we can the model can get closer to the true function <span class="math inline">\(f\)</span>; larger variance because there will typically be more parameters to estimate and so <span class="math inline">\(\hat{f}\)</span> is more sensitive to variation in the data.</p>
<p>For prediction purposes, we should consider this trade-off between bias and variance, given that they both contribute to prediction error, and note that a simpler model can be preferable to a more complex one, if the reduction in variance outweighs the increase in bias.</p>
</section>
<section id="measuring-goodness-of-fit-and-penalising-for-model-complexity" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="measuring-goodness-of-fit-and-penalising-for-model-complexity"><span class="header-section-number">9.3</span> Measuring goodness of fit and penalising for model complexity</h2>
<p>For choosing between different models, various measures of goodness of fit have been proposed, that include a penalty for the complexity of the model.</p>
<section id="the-adjusted-r2-statistic" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="the-adjusted-r2-statistic"><span class="header-section-number">9.3.1</span> The adjusted <span class="math inline">\(R^2\)</span> statistic</h3>
<p>We introduced this in Chapter 2, but will recap here. For <span class="math inline">\(n\)</span> observations and <span class="math inline">\(p\)</span> parameters in the model (i.e.&nbsp;<span class="math inline">\(\boldsymbol{\beta}\)</span> is a <span class="math inline">\(p\times 1\)</span> vector)</p>
<p><span class="math display">\[
R^2(adj):=1-\frac{RSS}{SS_{total}}\times\frac{n-1}{n-p}
\]</span> where <span class="math inline">\(RSS= \sum_{i=1}^n(y_i - \hat{y}_i)^2\)</span> is the residual sum of squares, and <span class="math inline">\(SS_{total}= \sum_{i=1}^n(y_i - \bar{y})^2\)</span> is the total sum of squares.</p>
<p><span class="math inline">\(R^2(adj)\)</span> increases (to an upper bound of 1) as the goodness of fit improves. Smaller squared residuals imply a better fitting model and increase <span class="math inline">\(R^2(adj)\)</span>, but <span class="math inline">\(R^2(adj)\)</span> is reduced as the number of parameters <span class="math inline">\(p\)</span> increases.</p>
</section>
<section id="aic-and-bic" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="aic-and-bic"><span class="header-section-number">9.3.2</span> AIC and BIC</h3>
<p>There are general purpose goodness of fit measures that involve the maximised log-likelihood: AIC and BIC are two of them. Informally, the likelihood is the ‘probability’ of observing the data we got, as a function of the model parameters, so the higher we can make this (by maximising the likelihood or log-likelihood), the closer the data would ‘fit’ the model.</p>
<p>Denote the maximised log-likelihood by <span class="math inline">\(\hat{l}\)</span>. Then Akaike’s Information Criterion (AIC) is defined as</p>
<p><span class="math display">\[
AIC:= -2\hat{l} + 2p
\]</span> and the Bayesian Information Criterion (BIC) is defined as <span class="math display">\[
BIC: = -2\hat{l} + n\log p
\]</span></p>
<p>Note that the lower the AIC and BIC values, the better the model fit. We see that AIC and BIC differ in the penalty applied for model complexity: the penalty of <span class="math inline">\(n\log p\)</span> in BIC grows with sample size, so BIC is more likely to favour simpler models.</p>
<p>Under various assumptions and approximations, AIC and BIC can be interpreted as estimating different quantities. The details are outside the scope of this module, but in brief AIC approximates how well the fitted model predicts a new observation, as measured by the Kullback-Liebler divergence between the true distribution of a new observation and the distribution in the fitted model. BIC approximates the log <em>marginal</em> likelihood of the observed data (the likelihood, averaged over a prior distribution for the model parameters.)</p>
<p>We can obtain AIC and BIC values with the commands <code>AIC()</code> and <code>BIC()</code> on fitted models in R.</p>
</section>
<section id="example" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3" class="anchored" data-anchor-id="example"><span class="header-section-number">9.3.3</span> Example</h3>
<p>We’ll use the respiration data again, but recode the data to make it easier to understand</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>respiration <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"https://oakleyj.github.io/exampledata/resp_data.txt"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>respiration<span class="sc">$</span>home <span class="ot">&lt;-</span> <span class="fu">factor</span>(respiration<span class="sc">$</span>home)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>respiration<span class="sc">$</span>smoke <span class="ot">&lt;-</span> <span class="fu">factor</span>(respiration<span class="sc">$</span>smoke)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>respiration<span class="sc">$</span>asthma <span class="ot">&lt;-</span> <span class="fu">factor</span>(respiration<span class="sc">$</span>asthma)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>respiration<span class="sc">$</span>asbestos <span class="ot">&lt;-</span> <span class="fu">factor</span>(respiration<span class="sc">$</span>asbestos)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>respiration <span class="ot">&lt;-</span> respiration <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">home =</span> <span class="fu">fct_recode</span>(home,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">England =</span> <span class="st">"1"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">Scotland =</span> <span class="st">"2"</span>, </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">Wales =</span> <span class="st">"3"</span>, </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">Northern_Ireland =</span> <span class="st">"4"</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoke =</span> <span class="fu">fct_recode</span>(smoke,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Yes =</span> <span class="st">"1"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">No =</span> <span class="st">"0"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                       ),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">asbestos =</span> <span class="fu">fct_recode</span>(asbestos,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Yes =</span> <span class="st">"1"</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">No =</span> <span class="st">"0"</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">asthma =</span> <span class="fu">fct_recode</span>(asthma,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Yes =</span> <span class="st">"1"</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">No =</span> <span class="st">"0"</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(respiration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
    vol exercise pulse pollution asbestos home             smoke asthma
  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;            &lt;fct&gt; &lt;fct&gt; 
1  117.     15.8  17.5     11.9  Yes      England          Yes   No    
2  148.     23.5  28.4      1.88 Yes      Wales            Yes   Yes   
3  214.     13.8  15.0      2.38 Yes      England          No    No    
4  162.     15.6  15.7      6.34 Yes      Wales            No    Yes   
5  352.     26.6  19.7      1.63 No       Northern_Ireland No    No    
6  304.     23.2  14.2      2.72 No       Northern_Ireland No    No    </code></pre>
</div>
</div>
<p>If we fit a model with all the independent variables, we can see that both <code>smoke</code> and <code>asthma</code> are significant, but the effect size is larger for <code>smoke</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>lmFull <span class="ot">&lt;-</span> <span class="fu">lm</span>(vol <span class="sc">~</span> ., respiration)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmFull)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = vol ~ ., data = respiration)

Residuals:
     Min       1Q   Median       3Q      Max 
-132.420  -19.206   -0.003   18.142  178.152 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           179.7789     7.7125  23.310  &lt; 2e-16 ***
exercise                4.0844     0.4706   8.680 2.74e-16 ***
pulse                  -0.3311     0.3754  -0.882    0.379    
pollution               0.9322     1.0816   0.862    0.389    
asbestosYes            -5.2549     4.2059  -1.249    0.213    
homeScotland            5.1136     5.6024   0.913    0.362    
homeWales               0.8963     5.6285   0.159    0.874    
homeNorthern_Ireland    5.7756     5.4727   1.055    0.292    
smokeYes             -120.9721     3.9683 -30.485  &lt; 2e-16 ***
asthmaYes             -49.8651     4.0839 -12.210  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 33.87 on 295 degrees of freedom
Multiple R-squared:  0.8246,    Adjusted R-squared:  0.8192 
F-statistic: 154.1 on 9 and 295 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>If we were to compare two models, one using <code>smoke</code> only and one using <code>asthma</code> only as the independent variable, we might expect the former to fit better as its coefficient is larger. We’ll compare <span class="math inline">\(R^2_{adj}\)</span>, AIC and BIC values to confirm this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lmSmoke <span class="ot">&lt;-</span> <span class="fu">lm</span>(vol <span class="sc">~</span> smoke, respiration)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lmAsthma <span class="ot">&lt;-</span> <span class="fu">lm</span>(vol <span class="sc">~</span> asthma, respiration)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmSmoke)<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.605248</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmAsthma)<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1175858</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(lmSmoke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3256.512</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(lmAsthma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3501.855</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(lmSmoke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3267.673</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(lmAsthma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3513.016</code></pre>
</div>
</div>
</section>
</section>
<section id="constrainedpenalised-regression" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="constrainedpenalised-regression"><span class="header-section-number">9.4</span> Constrained/penalised regression</h2>
<p>We will finish with a brief mention of some alternative methods for model fitting/selection that attempt to reduce prediction errors by reducing model complexity. We will just outline some methods, and then illustrate how to implement them in the Chapter appendix.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This really is a very brief introduction to the topic! The aim is just to get you started if you want to experiment with any of these methods at some later point. You will not be assessed on any of the following.</p>
</div>
</div>
<p>The idea is to minimise the residual sum of squares, subject to a constraint on the complexity of the model. We suppose there is a ‘full model’ we are willing to consider in matrix form <span class="math display">\[
\boldsymbol{Y} = X\boldsymbol{\beta}+\boldsymbol{\varepsilon}.
\]</span> Here, we write <span class="math display">\[
\boldsymbol{\beta} = \left(\begin{array}{c}\beta_0\\\beta_1\\\vdots\\ \beta_p\end{array}\right)
\]</span></p>
<p>and suppose that the first column of <span class="math inline">\(X\)</span> a column of 1s, so that the first element <span class="math inline">\(\beta_0\)</span> of <span class="math inline">\(\boldsymbol{\beta}\)</span> is just an intercept term. Define <span class="math inline">\(\boldsymbol{y}\)</span> to be the observed value of <span class="math inline">\(\boldsymbol{Y}\)</span>.</p>
<p>For ordinary least squares, we have <span class="math display">\[
\hat{\boldsymbol{\beta}} = \arg\min_{\boldsymbol{\beta}}\left((\boldsymbol{y} - X\boldsymbol{\beta})^T(\boldsymbol{y} - X\boldsymbol{\beta})\right),
\]</span> which we can solve analytically to get <span class="math inline">\(\hat{\boldsymbol{\beta}} = (X^TX)^{-1}X^T\boldsymbol{y}\)</span>.</p>
<p>An alternative approach is, <em>given the same model</em> <span class="math inline">\(\boldsymbol{Y} = X\boldsymbol{\beta}+\boldsymbol{\varepsilon}\)</span>, place some constraint on <span class="math inline">\(\boldsymbol{\beta}\)</span> when minimising <span class="math inline">\((\boldsymbol{y} - X\boldsymbol{\beta})^T(\boldsymbol{y} - X\boldsymbol{\beta})\)</span>. We will give three possibilities below.</p>
<section id="best-subset-selection" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="best-subset-selection"><span class="header-section-number">9.4.1</span> Best subset selection</h3>
<p>In this approach, we find the best fitting model (using least squares) out of all models with some reduced number <span class="math inline">\(k\)</span> of regressors:</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}}_{S} := \arg\min_{\boldsymbol{\beta}}\left((\boldsymbol{y} - X\boldsymbol{\beta})^T(\boldsymbol{y} - X\boldsymbol{\beta})\right), \quad\mbox{ subject to } \left(\sum_{j=1}^p I(\beta_j\neq 0)\right) = k.
\]</span> i.e., in addition to the intercept, only <span class="math inline">\(k&lt;p\)</span> elements of <span class="math inline">\(\boldsymbol{\beta}\)</span> are allowed to be non-zero.</p>
</section>
<section id="ridge-regression" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="ridge-regression"><span class="header-section-number">9.4.2</span> Ridge regression</h3>
<p>Rather than forcing elements of <span class="math inline">\(\boldsymbol{\beta}\)</span> to be zero, we can <em>shrink</em> them towards zero. This introduces bias into <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span>, but reduces the variance, potentially with an overall reduction in expected prediction error. We have</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}}_{R}: = \arg\min_{\boldsymbol{\beta}}\left((\boldsymbol{y} - X\boldsymbol{\beta})^T(\boldsymbol{y} - X\boldsymbol{\beta})\right), \quad\mbox{ subject to } \left(\sum_{j=1}^p \beta_j^2\right)\le t
\]</span></p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the constraint to make sense, columns 2 to <span class="math inline">\(p\)</span> of <span class="math inline">\(X\)</span> need to be on the same scale, e.g.&nbsp;transformed to be on the range <span class="math inline">\([-1, 1]\)</span>.</p>
</div>
</div>
<p>Note that <span class="math inline">\(\hat{\boldsymbol{\beta}}_{R}\)</span> can be re-expressed as</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}}_R = \arg\min_{\boldsymbol{\beta}}\left( (\boldsymbol{y} - X\boldsymbol{\beta})^T(\boldsymbol{y} - X\boldsymbol{\beta}) +\lambda \sum_{j=1}^p \beta_j^2\right).
\]</span> We can now see that ridge regression is a form of <em>penalised least squares</em>: we are minimising the sum of the squared errors plus an additional penalty for the size of the regression coefficients. Informally, this can also be thought of similar to a Bayesian approach, where each <span class="math inline">\(\beta_j\)</span> coefficient is given a <span class="math inline">\(N(0,\lambda)\)</span> prior.</p>
</section>
<section id="lasso" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3" class="anchored" data-anchor-id="lasso"><span class="header-section-number">9.4.3</span> Lasso</h3>
<p>Lasso is short for “least absolute shrinkage and selection operator”. It’s similar to ridge regression, but with a different penalty. We find</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}}_{L}: = \arg\min_{\boldsymbol{\beta}}\left((\boldsymbol{y} - X\boldsymbol{\beta})^T(\boldsymbol{y} - X\boldsymbol{\beta})\right), \quad\mbox{ subject to } \left(\sum_{j=1}^p |\beta_j|\right)\le t
\]</span></p>
<p>which can be re-expressed as <span class="math display">\[
\hat{\boldsymbol{\beta}}_L = \arg\min_{\boldsymbol{\beta}}\left( (\boldsymbol{y} - X\boldsymbol{\beta})^T(\boldsymbol{y} - X\boldsymbol{\beta}) +\lambda \sum_{j=1}^p |\beta_j|\right).
\]</span> Note that the independent variables need transforming such that the columns of <span class="math inline">\(X\)</span> are on the scale.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Lasso also ‘shrinks’ the <span class="math inline">\(\beta\)</span> coefficients towards 0, but more ‘aggressively’, as for <span class="math inline">\(|\beta_j|&lt;1\)</span> the penalty <span class="math inline">\(\lambda|\beta_j|\)</span> is greater than the penalty <span class="math inline">\(\lambda\beta_j^2\)</span>. This has the effect of performing variable selection.</p>
</div>
</div>
</section>
<section id="parameter-choices" class="level3" data-number="9.4.4">
<h3 data-number="9.4.4" class="anchored" data-anchor-id="parameter-choices"><span class="header-section-number">9.4.4</span> Parameter choices</h3>
<p>For the best subset selection method, we have to choose <span class="math inline">\(k\)</span>. Each value of <span class="math inline">\(k\)</span> results in a particular ‘best’ model as found by least squares; we might choose the best overall <span class="math inline">\(k\)</span> value by using any goodness of fit measure which includes a penalty for model complexity, such as AIC, BIC etc.</p>
<p>For ridge regression and the Lasso, we have to choose a parameter <span class="math inline">\(\lambda\)</span>. One approach is to use cross-validation which involves removing a subset of observations, fitting the model to the remainder, and then predicting the observations we removed. We won’t give the details here, but this topic is covered in the <a href="https://oakleyj.github.io/MAS61006Sem2/cross-validation.html">Computational Methods</a> course (second half of MAS61006)</p>
</section>
</section>
<section id="chapter-appendix" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="chapter-appendix"><span class="header-section-number">9.5</span> Chapter appendix</h2>
<p>We outline how to implement each of the above penalised regression methods in R</p>
<section id="best-subset-selection-with-leaps" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="best-subset-selection-with-leaps"><span class="header-section-number">9.5.1</span> Best subset selection with <code>leaps</code></h3>
<p>Best subset selection can be implemented with the <code>leaps</code> package <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The following command will find the best fitting regression model for <span class="math inline">\(k\)</span> taking values from 1 up to <code>nvmax</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lmBestSubset <span class="ot">&lt;-</span> leaps<span class="sc">::</span><span class="fu">regsubsets</span>(<span class="at">x =</span> vol <span class="sc">~</span> ., <span class="at">data =</span> respiration,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">nvmax =</span> <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The terms included for each <span class="math inline">\(k\)</span> can be visualised with the following plot. We would look to see which terms are included in the top row, as this has the smallest BIC:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmBestSubset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelSelection_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can extract the BIC values and best model as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bestSubsetResults <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmBestSubset)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>bestSubsetResults<span class="sc">$</span>bic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -273.0611 -383.8430 -503.3554 -499.1177 -494.2794 -489.3284 -484.3395
[8] -479.3691 -473.6750</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(bestSubsetResults<span class="sc">$</span>bic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>So the best overall model (according to BIC) is achieved with <span class="math inline">\(k=3\)</span> and includes the following terms:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bestSubsetResults<span class="sc">$</span>which[<span class="dv">3</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         (Intercept)             exercise                pulse 
                TRUE                 TRUE                FALSE 
           pollution          asbestosYes         homeScotland 
               FALSE                FALSE                FALSE 
           homeWales homeNorthern_Ireland             smokeYes 
               FALSE                FALSE                 TRUE 
           asthmaYes 
                TRUE </code></pre>
</div>
</div>
</section>
<section id="lasso-and-ridge-regression-with-glmnet" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="lasso-and-ridge-regression-with-glmnet"><span class="header-section-number">9.5.2</span> LASSO and Ridge Regression with <code>glmnet</code></h3>
<p>Lasso and ridge regression can be implemented with the <code>glmnet</code> package <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>We first fit the full model and extract the design matrix, excluding the intercept column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lmFull <span class="ot">&lt;-</span> <span class="fu">lm</span>(vol <span class="sc">~</span> ., respiration)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(lmFull)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> respiration<span class="sc">$</span>vol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we don’t need to standardise the columns of <code>X</code>: <code>glmnet</code> will do this for us. There is a single function we can use for both ridge regression and the lasso; an argument <code>alpha</code> determines which penalty is used. The function will automatically try a range of suitable <span class="math inline">\(\lambda\)</span> values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>lmLasso <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">glmnet</span>(<span class="at">x =</span> X, <span class="at">y =</span> y, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="co"># alpha = 1 for the lasso</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>lmRidge <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">glmnet</span>(<span class="at">x =</span> X, <span class="at">y =</span> y, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="co"># alpha = 0 for ridge regression</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see the shrinkage of the coefficients towards 0 as <span class="math inline">\(\lambda\)</span> increases. The numbers at the top show the number of non-zero <span class="math inline">\(\beta_j\)</span> coefficients. For the lasso we do</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmLasso, <span class="at">xvar =</span>  <span class="st">"lambda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelSelection_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Similarly for ridge regression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmRidge, <span class="at">xvar =</span>  <span class="st">"lambda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelSelection_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To choose a particular value of <span class="math inline">\(\lambda\)</span>, we do <a href="https://oakleyj.github.io/MAS61006Sem2/cross-validation.html">cross-validation</a>. This is implemented as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>lmLassoCV <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x =</span> X, <span class="at">y =</span> y, <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>lmRidgeCV <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x =</span> X, <span class="at">y =</span> y, <span class="at">alpha =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A recommendation is to choose <span class="math inline">\(\lambda\)</span> that gives a mean-squared prediction error within one standard error of the minimum. This is indicated by the right hand vertical dotted line in the following plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmLassoCV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelSelection_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>and extracted as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>lmLassoCV<span class="sc">$</span>lambda<span class="fl">.1</span>se</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.289264</code></pre>
</div>
</div>
<p>Similarly for ridge regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmRidgeCV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="modelSelection_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lmRidgeCV<span class="sc">$</span>lambda<span class="fl">.1</span>se</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.0056</code></pre>
</div>
</div>
<p>Finally, we compare coefficients using ordinary least square, the lasso, and ridge regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">coef</span>(lmFull),</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coef</span>(lmLassoCV, lmLassoCV<span class="sc">$</span>lambda<span class="fl">.1</span>se), </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coef</span>(lmRidgeCV, lmRidgeCV<span class="sc">$</span>lambda<span class="fl">.1</span>se))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10 x 3 sparse Matrix of class "dgCMatrix"
                                          s1          s1
(Intercept)           179.7789115  186.64575 172.8461992
exercise                4.0843780    2.80429   2.3440272
pulse                  -0.3311115    .         0.6438444
pollution               0.9322368    .         0.9372327
asbestosYes            -5.2548552    .        -1.8279559
homeScotland            5.1136247    .         2.6362831
homeWales               0.8962507    .         1.0010502
homeNorthern_Ireland    5.7756180    .         4.4893148
smokeYes             -120.9720708 -107.07152 -92.5895106
asthmaYes             -49.8651200  -35.16316 -38.8886080</code></pre>
</div>
</div>
<p>A <code>.</code> indicates a coefficient set to 0 in the lasso, which we can think of as variable selection. In this example, this is the same as the coefficients that are not significantly different from 0 in the full model. Note also how (intercept excluded), the coefficients are typically closer to 0 for the lasso and ridge regression models, compared to the full model.</p>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Thomas Lumley based on Fortran code by Alan Miller (2020). leaps: Regression Subset Selection. R package version 3.1. https://CRAN.R-project.org/package=leaps<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Friedman J, Tibshirani R, Hastie T (2010). “Regularization Paths for Generalized Linear Models via Coordinate Descent.” <em>Journal of Statistical Software</em>, <em>33</em>(1), 1-22. doi: 10.18637/jss.v033.i01 (URL: https://doi.org/10.18637/jss.v033.i01).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./transformations.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Transformations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./matrixAlgebra.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Matrix algebra essentials</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>