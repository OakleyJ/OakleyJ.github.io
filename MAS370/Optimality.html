<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Optimality – MAS370/61003 Sampling Theory and Design of Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Qualitative-single factor.html" rel="next">
<link href="./Review of linear models.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction to experimental design.html">Part I: Experimental Design</a></li><li class="breadcrumb-item"><a href="./Optimality.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MAS370/61003 Sampling Theory and Design of Experiments</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructions</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Experimental Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to experimental design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Experimental Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Review of linear models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A review of linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Optimality.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-single factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designs for qualitative explanatory variables: one factor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-multiple factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Designs for qualitative explanatory variables: multiple factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Factorial designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Factorial designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Designs for mixture experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Designs for mixture experiments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Continuous and exact designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Continuous and exact designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tailor-made designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Tailor-made designs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Sampling Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Simple random sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Simple Random Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Stratified sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Stratified Sampling: Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Cluster sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Cluster Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Population size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Estimating a Population Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Practicalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Practicalities of Surveys: Problems at the Planning Stage</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Computer Experiments (MAS61003 only)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction-computer-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Uncertainty-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Uncertainty analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Sensitivity-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Sensitivity analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#optimality-criteria" id="toc-optimality-criteria" class="nav-link active" data-scroll-target="#optimality-criteria"><span class="header-section-number">3.1</span> Optimality criteria</a>
  <ul class="collapse">
  <li><a href="#d-optimality" id="toc-d-optimality" class="nav-link" data-scroll-target="#d-optimality"><span class="header-section-number">3.1.1</span> <em>D</em>-optimality</a></li>
  <li><a href="#g-optimality" id="toc-g-optimality" class="nav-link" data-scroll-target="#g-optimality"><span class="header-section-number">3.1.2</span> <em>G</em>-optimality</a></li>
  <li><a href="#v-optimality." id="toc-v-optimality." class="nav-link" data-scroll-target="#v-optimality."><span class="header-section-number">3.1.3</span> <em>V</em>-optimality.</a></li>
  <li><a href="#a-optimality" id="toc-a-optimality" class="nav-link" data-scroll-target="#a-optimality"><span class="header-section-number">3.1.4</span> <em>A</em>-optimality</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction to experimental design.html">Part I: Experimental Design</a></li><li class="breadcrumb-item"><a href="./Optimality.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>We have seen the role of the information matrix <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> in both prediction and inference (using confidence regions to give interval estimates for <span class="math inline">\(\boldsymbol{\beta}\)</span>). In both cases, it seems that a design is good for both prediction and inference if the information matrix <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> is ‘’large” in some sense, so that its inverse is’‘small”. However, unless there is only one parameter in the model, in which case this matrix is in fact just a scalar, there is not a unique way of describing the’’size” of a matrix, and it follows that there is no obviously pre-eminent criterion for characterising the optimality of a design among a choice of possible designs.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-origin" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.1</strong></span> One example of a model with only one parameter is simple linear regression without intercept: <span class="math display">\[Y = \beta x + \epsilon\]</span> for which the information matrix is just the scalar <span class="math inline">\(\sum x^2\)</span>. If the explanatory variable is non-negative with some maximum feasible value <span class="math inline">\(x_{max}\)</span> say, then, according to the criterion of maximising <span class="math inline">\(\sum x^2\)</span> for some given total number of observations, it appears that it is optimal to take all the observations at <span class="math inline">\(x=x_{max}\)</span>. This is technically true, but in other respects this design does not seem very sensible, if only because it yields no evidence as to whether the model fits well in the bulk of the range of possible values of <span class="math inline">\(x\)</span>.*</p>
</div>
</div>
</div>
<p>When there is more than one parameter, a similar exercise can be conducted if the sole objective is to minimise the variance of the estimator of a particular parameter, or possibly a linear combination of the parameters.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-3.2" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.2</strong></span> <span class="math inline">\(n\)</span> patients are to be divided into two groups, those in the first group of size <span class="math inline">\(t\)</span> to be given a treatment and the remaining <span class="math inline">\(n-t\)</span> to be given a placebo. The model is <span class="math display">\[E(Y) = \mu + \alpha z\]</span> where <span class="math inline">\(z=1\)</span> for treated patients and <span class="math inline">\(z=0\)</span> for the rest, so that <span class="math inline">\(\alpha\)</span> represents the treatment effect. What is the value of <span class="math inline">\(t\)</span> which minimises the variance of <span class="math inline">\(\hat{\alpha }\)</span>?</p>
<p>In this case it is easy to see that <span class="math inline">\(\hat{\alpha }\)</span> is just the difference between the two group means, and has variance given by <span class="math display">\[v(t) = \sigma ^2 \left( \frac{1}{t} + \frac{1}{n-t} \right).\]</span> Treating <span class="math inline">\(t\)</span> as a continuous variable, <span class="math display">\[\begin{align}
\frac{d}{dt} v(t) &amp; =  \sigma ^2 \left( -\frac{1}{t^2} +
\frac{1}{(n-t)^2} \right) \\
\mbox{and  }\frac{d^2}{dt^2} v(t) &amp; =  \sigma ^2 \left(
\frac{2}{t^3} + \frac{2}{(n-t)^3} \right) &gt; 0.
\end{align}\]</span> Hence <span class="math inline">\(v(t)\)</span> is minimised when <span class="math inline">\(t^2 = (n-t)^2\)</span>, which, since <span class="math inline">\(t\)</span> and <span class="math inline">\(n-t\)</span> are meant to be both positive, implies that <span class="math inline">\(t=n-t\)</span>: the two groups must be equal in size, or as nearly as possible so (since <span class="math inline">\(t\)</span> must be an integer).</p>
</div>
</div>
</div>
<p>In this last example, the minimum was located by calculus, and it was checked that the turning point was indeed a minimum rather than a maximum.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>In many cases the explanatory variable only takes values in a bounded interval, typically <span class="math inline">\([-1,1]\)</span>, and the maximum or minimum may occur outside the interval: you can’t rely on differentiating and equating to zero to find the maximum/minimum. Some basic curve sketching can help you to see what the minimum or maximum is; you will often need to think about what happens then the variable is at one of the interval limits.</p>
</div>
</div>
<section id="optimality-criteria" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="optimality-criteria"><span class="header-section-number">3.1</span> Optimality criteria</h2>
<p>If there is not a simple one-dimensional function of the design which is to be maximised or minimised, there are various different criteria which are candidates for consideration. We consider four here, although there are others.</p>
<section id="d-optimality" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="d-optimality"><span class="header-section-number">3.1.1</span> <em>D</em>-optimality</h3>
<p>A design is called <em>D</em>-optimal if it maximises the <em>determinant</em> of <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span>, denoted by <span class="math inline">\(|\mathbf{X}^T\mathbf{X}|\)</span>, or equivalently the determinant of <span class="math inline">\(\mathbf{M}\)</span>, denoted by <span class="math inline">\(|\mathbf{M}|\)</span>. Thus, the determinant is being used as a measure of the ’’size” of a matrix. This makes sense when the matrix is positive definite symmetric, as here, because the determinant is the product of the eigenvalues, which are necessarily all real and positive. Another way of looking at this criterion is that minimises the “measure of content” (area, volume, …) of the confidence ellipsoids for <span class="math inline">\(\boldsymbol{\beta}\)</span> mentioned in <a href="Review of linear models.html#sec-confregions" class="quarto-xref"><span>Section 2.10</span></a>, and this measure of content is a reflection of the accuracy of estimation.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-Doptimallinmod" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.3</strong></span> In simple linear regression, we noted that <span class="math display">\[\begin{align}
    \mathbf{X}^T\mathbf{X}&amp;=\left( \begin{array}{cc} n &amp; \sum x \\
    \sum x &amp; \sum x^2 \end{array} \right) \\
    \text{and so } |\mathbf{X}^T\mathbf{X}| &amp;= n\sum x^2-(\sum x)^2 \\
    &amp;= ns_{xx}
    \end{align}\]</span> so that for given sample size it is <em>D</em>-optimal to choose <span class="math inline">\(s_{xx}\)</span> as large as possible. If the range of feasible <span class="math inline">\(x\)</span> is a finite interval <span class="math inline">\([x_{min},         x_{max}]\)</span> say, then this amounts to taking half the observations at <span class="math inline">\(x=x_{min}\)</span> and half at <span class="math inline">\(x=x_{max}\)</span>, or as nearly as possible so. Although such a design is <em>D</em>-optimal, it has the same disadvantage as that of <a href="#exm-origin" class="quarto-xref">Example&nbsp;<span>3.1</span></a> in that it yields no evidence that the model fits well in the middle of the range of values of <span class="math inline">\(x\)</span>.*</p>
</div>
</div>
</div>
</section>
<section id="g-optimality" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="g-optimality"><span class="header-section-number">3.1.2</span> <em>G</em>-optimality</h3>
<p>Let <span class="math inline">\(\Omega\)</span> denote the design region: the space of possible positions of <span class="math inline">\(k\)</span> design points. A design <span class="math inline">\(\mathbf{x_1}^*, \mathbf{x_2}^*, \ldots                 ,\mathbf{x_k}^ \in \Omega\)</span> is called <em>G</em>-optimal if it <em>minimises</em> the <em>maximum</em> standardised variance of prediction over the whole design region. Equivalently <span class="math display">\[\mathbf{x_1}^*,\mathbf{x_2}^*,\ldots,\mathbf{x_k}^*=\mathop{\mathrm{argmin}}_{\mathbf{x_1},\mathbf{x_2},\ldots,\mathbf{x_k}\in\Omega}
    \left\{ \max_{\mathbf{x_r}\in\Omega} d(\mathbf{x_r})\right\}\]</span> where <span class="math inline">\(d(\mathbf{x})\)</span> is the standardised variance of prediction at a point <span class="math inline">\(\mathbf{x}\)</span>. So in principle for each potential design we evaluate the worst possible variance of prediction within the design region, and then choose the design for which this is least.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-Goptimal" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.4</strong></span> In the simple linear regression model, following on from <a href="#exm-Doptimallinmod" class="quarto-xref">Example&nbsp;<span>3.3</span></a>, we get <span class="math display">\[d(x)=1+\frac{n(x-\overline{x})^2}{s_{xx}}\]</span> which is maximised when <span class="math inline">\(x\)</span> is as far as possible from <span class="math inline">\(\overline{x}\)</span>, namely whichever endpoint <span class="math inline">\(x_{min}\)</span> or <span class="math inline">\(x_{max}\)</span> is further away from <span class="math inline">\(\overline{x}\)</span>. In particular, the maximised value of <span class="math inline">\((x-\overline{x})^2\)</span> will always be at least <span class="math inline">\(\frac{1}{4}(x_{max}-x_{min})^2\)</span>. It can be seen that by taking half the observations at <span class="math inline">\(x=x_{min}\)</span> and half at <span class="math inline">\(x=x_{max}\)</span> we get <span class="math inline">\(\overline{x}=\frac{1}{2}(x_{min}+x_{max})\)</span> and then we simultaneously minimise the maximum value of <span class="math inline">\((x-\overline{x})^2\)</span> and maximise the value of <span class="math inline">\(s_{xx}\)</span>, thereby minimising the maximum value of <span class="math inline">\(d(x)\)</span> in the interval. Hence in this case the <em>G</em>-optimality criterion leads to the same design as the <em>D</em>-optimality criterion.</p>
</div>
</div>
</div>
</section>
<section id="v-optimality." class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="v-optimality."><span class="header-section-number">3.1.3</span> <em>V</em>-optimality.</h3>
<p>A design is called <em>V</em>-optimal if it minimises a weighted average <span class="math display">\[\int_{\Omega } d(\mathbf{x}) w(\mathbf{x}) d\mathbf{x}\]</span> of the standardised variance of prediction over the design region. Here <span class="math inline">\(w\)</span> is some non-negative weighting function, which could be scaled to integrate to <span class="math inline">\(1\)</span>, although this is not necessary.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-Voptimal" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.5</strong></span> Simple linear regression with <span class="math inline">\(x\in [-1,1]\)</span> and uniform weighting: we require to minimise <span class="math display">\[\begin{align}
\int_{-1}^1 \left(1+\frac{n(x-\overline{x})^2}{s_{xx}}\right) dx &amp;=2+\frac{n}{s_{xx}} \left[\frac{(x-\overline{x})^3}{3}\right]_{-1}^1 \\
&amp;= 2 + \frac{n}{3s_{xx}} \{ (1-\overline{x})^3- (-1-\overline{x})^3 \} \\
&amp;= 2 + \frac{n}{3s_{xx}} \{ 2 + 6\overline{x}^2\}.
\end{align}\]</span> Once again, we see that if there are an even number of observations, taking half of the observations at each of the end-points we simultaneously minimise <span class="math inline">\(\overline{x}^2\)</span> (as zero) and maximise <span class="math inline">\(s_{xx}\)</span>, and therefore minimise the above expression. So, in this case, <em>D</em>-optimality, <em>G</em>-optimality and <em>V</em>-optimality all yield the same design.</p>
</div>
</div>
</div>
</section>
<section id="a-optimality" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="a-optimality"><span class="header-section-number">3.1.4</span> <em>A</em>-optimality</h3>
<p>A design is called <em>A</em>-optimal if it minimises the <em>trace</em> (sum of the diagonal elements) of <span class="math inline">\((\mathbf{x}^T\mathbf{x})^{-1}\)</span>, denoted by <span class="math inline">\(\text{tr}(\mathbf{x}^T\mathbf{x})^{-1}\)</span>. Equivalently, it minimises the sum of the variances of the parameter estimators. This concept is only really appropriate when the parameters are all measured in the same dimensions, since otherwise the weighting given to any parameter will depend upon the units in which it is measured. For example, in the simple linear regression model, <span class="math inline">\(\beta_0\)</span> has the dimensions of <span class="math inline">\(y\)</span>, the response variable, whereas <span class="math inline">\(\beta_1\)</span> has the dimensions of <span class="math inline">\(yx^{-1}\)</span>, where <span class="math inline">\(x\)</span> is the explanatory variable, and so there is no good reason to add the variances of <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_1}\)</span> together.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question is 1 designed to help you practise the sort of algebra you need on this module. Questions 2 and 3 are good exam revision exercises. Questions 4 and 5 are a little more challenging!
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exr-quadReg" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.1</strong></span> &nbsp;</p>
<ol type="1">
<li><p>Check the details of the calculations in <a href="Review of linear models.html#exm-2.6" class="quarto-xref">Example&nbsp;<span>2.6</span></a>. (Start with the left hand side of each expression, and check you get the same result for the right hand side.)</p></li>
<li><p>To estimate in the quadratic regression model <span class="math display">\[ E(Y) = \beta_0 + \beta_1x + \beta_{11}x^2 \]</span> for <span class="math inline">\(x\in [-1,1]\)</span> it is proposed to take observations at the three points <span class="math inline">\(x=1\)</span>, <span class="math inline">\(x=-1\)</span> and <span class="math inline">\(x=a\)</span> for some <span class="math inline">\(a\in [-1,1]\)</span>. Show that the <em>D</em>-optimal choice of <span class="math inline">\(a\)</span> is <span class="math inline">\(a=0\)</span>. Note that if <span class="math inline">\(\mathbf{X}\)</span> is a square matrix, then <span class="math inline">\(|\mathbf{X}^T\mathbf{X}|=|\mathbf{X}^T||\mathbf{X}|=|\mathbf{X}|^2\)</span>. Show also that for this design with <span class="math inline">\(a=0\)</span>, <span class="math display">\[\max _{x\in [-1,1]} d(x) = 3\]</span> and the maximum occurs at each of the three points of the design <span class="math inline">\(x=\pm 1\)</span> and <span class="math inline">\(x=0\)</span>. [The significance of this result will become clear later.]</p></li>
<li><p>What is the V-optimal design in <a href="#exm-Voptimal" class="quarto-xref">Example&nbsp;<span>3.5</span></a> if the weighting function is <span class="math inline">\(w(x)=x^2\)</span> with an even number of observations? Hint: follow the opimisation approach in the example: don’t try to differentiate anything!</p></li>
<li><p>Still using V-optimality, give a weighting function in <a href="#exm-Voptimal" class="quarto-xref">Example&nbsp;<span>3.5</span></a> that does not lead to the same design as in <a href="#exm-Voptimal" class="quarto-xref">Example&nbsp;<span>3.5</span></a> with 2 observations.</p></li>
<li><p>Suppose we choose the uniform weight function in <a href="#exm-Voptimal" class="quarto-xref">Example&nbsp;<span>3.5</span></a> and there are an odd number <span class="math inline">\(n\)</span> of observations. Consider two designs</p>
<ul>
<li>Design A: <span class="math inline">\(\left\{ \begin{array}{ll}\frac{n-1}{2} \text{ observations at } &amp;  x=-1 \\
\frac{n+1}{2} \text{ observations at } &amp;  x=1 \end{array}\right.\)</span></li>
<li>Design B: <span class="math inline">\(\left\{ \begin{array}{ll}\frac{n-1}{2} \text{ observations at } &amp;  x=-1 \\
\frac{n-1}{2} \text{ observations at } &amp;  x=1 \\
1 \quad \text{ observations at } &amp;  x=0 \end{array}\right.\)</span></li>
</ul>
<p>If Designs A and B are the only available designs, which is <span class="math inline">\(V\)</span>-optimal?</p></li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>The determinant of <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> is <span class="math inline">\(n\sum x^2 - (\sum x)^2 =
ns_{xx}\)</span>, and then the expression for <span class="math inline">\((\mathbf{X} ^T\mathbf{X} )^{-1}\)</span> follows by the standard method of inverting a <span class="math inline">\(2\times 2\)</span> matrix. <span class="math display">\[\begin{align} \left(
\begin{array}{cc} 1 &amp; x_0 \end{array} \right) \left(
\begin{array}{cc} \sum x^2 &amp; -\sum x \\ -\sum x &amp; n \end{array}
\right) \left( \begin{array}{c} 1 \\ x_0 \end{array} \right) &amp; =
\left( \begin{array}{cc} \sum x^2-x_0\sum x &amp; -\sum x+nx_0
\end{array} \right) \left( \begin{array}{c} 1 \\ x_0 \end{array}
\right) \\
&amp; =  \sum x^2 - 2x_0\sum x + nx_0^2 \\
&amp; =  s_{xx} + n\overline{x}^2 - 2nx_0\overline{x} + nx_0^2 \\
&amp; =  s_{xx} + n(x_0-\overline{x})^2
\end{align}\]</span> and then multiplying by <span class="math inline">\(\sigma ^2/(ns_{xx})\)</span> gives the desired expression.</p></li>
<li><p>We have <span class="math display">\[\begin{align}
|\mathbf{X} | &amp; =  \begin{array}{|ccc|} 1 &amp; 1 &amp; 1 \\ 1 &amp; -1 &amp; 1 \\ 1 &amp; a &amp;
a^2 \end{array} \\
&amp; =  2 - 2a^2. \\
\mbox{So~~~~}|\mathbf{X} ^T\mathbf{X}| &amp;=4(1-a^2)^2
\end{align}\]</span> which is maximised when <span class="math inline">\(a=0\)</span>. In this case, <span class="math display">\[\begin{align}
\mathbf{X} ^T\mathbf{X} &amp;=\left( \begin{array}{ccc} 3 &amp; 0 &amp; 2 \\ 0 &amp; 2 &amp; 0 \\
2 &amp;
0 &amp; 2 \end{array} \right) \\
\mbox{and~~~~}(\mathbf{X} ^T\mathbf{X} )^{-1} &amp;=\frac{1}{4} \left(
\begin{array}{ccc} 4 &amp; 0 &amp; -4 \\ 0 &amp; 2 &amp; 0 \\ -4 &amp; 0 &amp; 6 \end{array}
\right) . \\
d(x) &amp;=\frac{3}{4} \left( \begin{array}{ccc} 1 &amp; x &amp; x^2
\end{array} \right) \left( \begin{array}{ccc} 4 &amp; 0 &amp; -4 \\ 0 &amp; 2 &amp;
0 \\ -4 &amp; 0 &amp; 6 \end{array} \right) \left( \begin{array}{c} 1 \\ x
\\ x^2 \end{array} \right) \\
&amp;=\frac{3}{4}(4-6x^2 +6x^4)\mbox{~~~~after~some~algebra} \\
&amp;=\frac{3}{4} \left\{ 6 \left( x^2 - \frac{1}{2} \right) ^2 +
\frac{5}{2} \right\} .
\end{align}\]</span> This is maximised when <span class="math inline">\(x^2\)</span> is as far as possible from <span class="math inline">\(\frac{1}{2}\)</span>, namely <span class="math inline">\(x^2=0\mbox{~or~}1\)</span>, and so <span class="math inline">\(x=0\mbox{~or~}\pm
1\)</span>. Then its value is <span class="math display">\[\frac{3}{4}\left\{ \frac{6}{4} + \frac{5}{2} \right\} = 3 . \]</span></p></li>
<li><p>We have <span class="math display">\[\int _{-1}^1 x^2 \left( 1 + \frac{n(x-\overline{x})^2}{s_{xx}} \right) dx  =  \frac{2}{3} + \frac{2n}{15s_{xx}}\left( 3+5\bar{x}^2\right) \]</span> so we again see that with an even number of observations it is <span class="math inline">\(V\)</span>-optimal to choose half at <span class="math inline">\(x=1\)</span> and half at <span class="math inline">\(x=-1\)</span> since <span class="math inline">\(\bar{x}=0\)</span> and <span class="math inline">\(s_{xx}\)</span> is maximised.</p></li>
<li><p>Consider the weight function <span class="math inline">\(w(x)\)</span> given by <span class="math display">\[
w(x)= \left\{ \begin{array}{ll} 0 &amp; ~ \mbox{for}~ x \leq 0 \\
1 &amp; ~ \mbox{for}~ x &gt;0
\end{array}\right.
\]</span> Then <span class="math display">\[\begin{align}
\int _{0}^1 \left( 1 + \frac{n(x-\overline{x})^2}{s_{xx}} \right)dx
&amp;=1 + \frac{n}{s_{xx}} \left[ \frac{(x-\overline{x})^3}{3} \right] _{0}^1 \\
&amp;=1 + \frac{n}{3s_{xx}} \{ 1 -3\overline{x}+3\overline{x}^2 \} .
\end{align}\]</span> If we take <span class="math inline">\(x =\{-1,1\}\)</span> then <span class="math inline">\(1 + \frac{n}{3s_{xx}} \{ 1 -3\overline{x}+3\overline{x}^2 \}=4/3\)</span> whereas if <span class="math inline">\(x =\{-0.8,1\}\)</span> then <span class="math inline">\(1 + \frac{n}{3s_{xx}} \{ 1 -3\overline{x}+3\overline{x}^2 \}=316/243&lt;4/3\)</span>. So the design in Example 3.1.3 is not <span class="math inline">\(V\)</span>-optimal.</p></li>
<li><p>For design A, <span class="math inline">\(\overline{x}=\frac{1}{n}\)</span> and <span class="math display">\[\begin{align}
s_{xx}&amp;=\frac{n-1}{2}\left(1+\frac{1}{n}\right)^2 + \frac{n+1}{2}\left(1-\frac{1}{n}\right)^2\\
&amp;=\frac{(n-1)(n+1)}{n}
\end{align}\]</span> so <span class="math display">\[\begin{align}
\frac{2+6\overline{x}^2}{s_{xx}}&amp;=\left(\frac{2}{n-1}\right)\left(\frac{n^2+3}{n(n+1)}\right)
\end{align}\]</span> For design B, <span class="math inline">\(\overline{x}=0\)</span> and <span class="math display">\[\begin{align}
s_{xx}&amp;=\frac{n-1}{2}(1)^2 + \frac{n-1}{2}(1)^2\\
&amp;=n-1
\end{align}\]</span> so <span class="math display">\[\begin{align}
\frac{2+6\overline{x}^2}{s_{xx}}&amp;=\frac{2}{n-1}
\end{align}\]</span> If <span class="math inline">\(n=3\)</span> these are the same so both are <span class="math inline">\(V\)</span>-optimal. If <span class="math inline">\(n\)</span> is odd and <span class="math inline">\(n \geq 5\)</span> then for Design A <span class="math display">\[\begin{align}
\frac{2+6\overline{x}^2}{s_{xx}}&amp;=\left(\frac{2}{n-1}\right)\left(\frac{n^2+3}{n(n+1)}\right)\\
&amp;=\left(\frac{2}{n-1}\right)\left(\frac{n^2+3}{n^2+n}\right)\\
&amp;&lt;\frac{2}{n-1}
\end{align}\]</span> and so Design A is <span class="math inline">\(V\)</span>-optimal.</p></li>
</ol>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Review of linear models.html" class="pagination-link" aria-label="A review of linear models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A review of linear models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Qualitative-single factor.html" class="pagination-link" aria-label="Designs for qualitative explanatory variables: one factor">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designs for qualitative explanatory variables: one factor</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>