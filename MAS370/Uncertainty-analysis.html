<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>17&nbsp; Uncertainty analysis – MAS370/61003 Sampling Theory and Design of Experiments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Sensitivity-analysis.html" rel="next">
<link href="./Introduction-computer-experiments.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction-computer-experiments.html">Part III: Computer Experiments (MAS61003 only)</a></li><li class="breadcrumb-item"><a href="./Uncertainty-analysis.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Uncertainty analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MAS370/61003 Sampling Theory and Design of Experiments</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructions</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Experimental Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to experimental design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Experimental Design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Review of linear models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A review of linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Optimality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-single factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Designs for qualitative explanatory variables: one factor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Qualitative-multiple factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Designs for qualitative explanatory variables: multiple factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Factorial designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Factorial designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Designs for mixture experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Designs for mixture experiments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Continuous and exact designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Continuous and exact designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tailor-made designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Tailor-made designs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Sampling Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Simple random sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Simple Random Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Stratified sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Stratified Sampling: Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Cluster sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Cluster Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Population size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Estimating a Population Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Practicalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Practicalities of Surveys: Problems at the Planning Stage</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Computer Experiments (MAS61003 only)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction-computer-experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Uncertainty-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Uncertainty analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Sensitivity-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Sensitivity analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#probabilistic-uncertainty-analysis" id="toc-probabilistic-uncertainty-analysis" class="nav-link active" data-scroll-target="#probabilistic-uncertainty-analysis"><span class="header-section-number">17.1</span> Probabilistic uncertainty analysis</a></li>
  <li><a href="#probabilistic-uncertainty-analysis-in-health-economic-evaluation" id="toc-probabilistic-uncertainty-analysis-in-health-economic-evaluation" class="nav-link" data-scroll-target="#probabilistic-uncertainty-analysis-in-health-economic-evaluation"><span class="header-section-number">17.2</span> Probabilistic uncertainty analysis in health economic evaluation</a></li>
  <li><a href="#case-study" id="toc-case-study" class="nav-link" data-scroll-target="#case-study"><span class="header-section-number">17.3</span> Case study</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Introduction-computer-experiments.html">Part III: Computer Experiments (MAS61003 only)</a></li><li class="breadcrumb-item"><a href="./Uncertainty-analysis.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Uncertainty analysis</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Uncertainty analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>We consider a model of the form <span class="math inline">\(y=f(\mathbf{x})\)</span>, where <span class="math inline">\(y\)</span> is a scalar output and <span class="math inline">\(\mathbf{x}=(x_1,\ldots,x_d)\)</span> is a vector of <span class="math inline">\(d\)</span> inputs. We suppose that there is a true value of the input <span class="math inline">\(\mathbf{x}\)</span> such that we would like to know the value of <span class="math inline">\(Y\)</span> where <span class="math inline">\(Y=f(\mathbf{x})\)</span>, but <span class="math inline">\(\mathbf{x}\)</span> is unknown. A simple approach might be</p>
<ol type="1">
<li><p>Obtain (somehow) a ‘best estimate’ of <span class="math inline">\(\mathbf{x}\)</span>, which we denote by <span class="math inline">\(\hat{\mathbf{x}}=(\hat{X}_1,\ldots,\hat{X}_d)\)</span>.</p></li>
<li><p>Estimate <span class="math inline">\(Y\)</span> by <span class="math inline">\(\hat{Y}=f(\hat{\mathbf{x}})\)</span>.</p></li>
<li><p>Do a one-at-a-time experiment to assess uncertainty about <span class="math inline">\(Y\)</span>: for <span class="math inline">\(i=1,\ldots,d\)</span>, compare <span class="math inline">\(\hat{Y}\)</span> with <span class="math inline">\(\hat{Y}_{i,+}\)</span> and <span class="math inline">\(\hat{Y}_{i,-}\)</span>, where <span class="math inline">\(\hat{Y}_{i,+}\)</span> and <span class="math inline">\(\hat{Y}_{i,-}\)</span> correspond to model runs with the <span class="math inline">\(i\)</span>th element of <span class="math inline">\(\hat{\mathbf{x}}\)</span> replaced by <span class="math inline">\(\hat{X}_i +e_i\)</span> and <span class="math inline">\(\hat{X}_i -e_i\)</span> respectively, for some appropriate choice of <span class="math inline">\(e_i\)</span>.</p></li>
</ol>
<p>This approach is not recommended, for reasons illustrated in the following two examples.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-chisq" class="theorem example">
<p><span class="theorem-title"><strong>Example 17.1</strong></span> Consider a model given by the function <span class="math inline">\(y=x^2\)</span>. Suppose we have <span class="math inline">\(X\sim N(0,1)\)</span>, and we wish to estimate <span class="math inline">\(Y=f(X)\)</span>. If we want to estimate <span class="math inline">\(Y\)</span> using its expected value, we find <span class="math display">\[1=E(Y)\neq f(E(X))=f(0)=0.\]</span> (Note that if <span class="math inline">\(X\sim N(0,1)\)</span>, then <span class="math inline">\(Y=X^2\sim \chi^2_1\)</span>, so <span class="math inline">\(E(Y)=1\)</span>).</p>
</div>
</div>
</div>
<p>In general, if <span class="math inline">\(f\)</span> is a nonlinear function of the inputs, we would not expect <span class="math inline">\(E(Y)\)</span> to be the same as <span class="math inline">\(f(E(\mathbf{x}))\)</span>.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-toy2d" class="theorem example">
<p><span class="theorem-title"><strong>Example 17.2</strong></span> Consider the function <span class="math inline">\(y=f(x_1,x_2)=x_1x_2\)</span>, and suppose we wish to assess uncertainty in <span class="math inline">\(Y=f(X_1,X_2)\)</span>, where <span class="math inline">\(X_1\sim N(0,1)\)</span> and <span class="math inline">\(X_2\sim N(0,1)\)</span>. For a baseline value, we might consider <span class="math inline">\(X_1=0\)</span> and <span class="math inline">\(X_2=0\)</span>, and evaluate <span class="math inline">\(f(0,0)\)</span>. Then, for any choice of <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span>, we have <span class="math display">\[f(0,0)=f(-e_1,0)=f(e_1,0)=f(0,-e_2)=f(0,e_2)=0,\]</span> i.e. none of model runs produce a non-zero output, so the one-at-a-time method gives no information about the uncertainty in <span class="math inline">\(Y=f(X_1,X_2)\)</span>.</p>
</div>
</div>
</div>
<p>Some further comments.</p>
<ol type="1">
<li><p>How do we choose the <span class="math inline">\(e_i\)</span> terms? Should these correspond to the absolute physical limits of the input parameters? Or should we attempting to judge what values of the inputs are likely? And how should we interpret the results? The one-at-a-time experiment may reveal some outputs that are <em>possible</em> but not necessarily <em>plausible</em>.</p></li>
<li><p>Instead of a one-at-a-time experiment, we might consider a factorial or fractional factorial experiment (more on these later on in this module). These can be more efficient for noisy (non-deterministic) physical experiments, but the problems of non-linearity and interpretability remain.</p></li>
</ol>
<section id="probabilistic-uncertainty-analysis" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="probabilistic-uncertainty-analysis"><span class="header-section-number">17.1</span> Probabilistic uncertainty analysis</h2>
<p>The examples in the previous section have already hinted at a probabilistic approach, but we will now consider this more formally. Given an uncertain <span class="math inline">\(\mathbf{x}\)</span>, the aim is to quantify uncertainty about <span class="math inline">\(Y=f(\mathbf{x})\)</span> by deriving a probability distribution for <span class="math inline">\(Y\)</span>. This first requires a probability distribution for <span class="math inline">\(\mathbf{x}\)</span>. If suitable data are available that inform us about <span class="math inline">\(\mathbf{x}\)</span>, we may derive a (posterior) probability distribution for <span class="math inline">\(\mathbf{x}\)</span> using Bayesian inference. Without data, we may instead use expert judgement (so that we simply have a prior distribution for <span class="math inline">\(\mathbf{x}\)</span>).</p>
<p>We now have a transformation of a random variable <span class="math inline">\(Y=f(\mathbf{x})\)</span>. In very simple cases, given a density function for <span class="math inline">\(\mathbf{x}\)</span>, we may be able to derive the density function for <span class="math inline">\(Y\)</span>, but typically, this will not be possible. (At the very least, we would need a closed form expression for <span class="math inline">\(f\)</span>). We can instead use a Monte Carlo technique.</p>
<ol type="1">
<li><p>Generate a random sample <span class="math inline">\(\mathbf{x}_1,\ldots,\mathbf{x}_N\)</span> from the distribution of <span class="math inline">\(\mathbf{x}\)</span>.</p></li>
<li><p>Evaluate <span class="math inline">\(Y_1=f(\mathbf{x}_1),\ldots,Y_N=f(\mathbf{x}_N)\)</span>.</p></li>
<li><p>Use the sample <span class="math inline">\(Y_1,\ldots,Y_N\)</span> to estimate summaries of the distribution of <span class="math inline">\(Y\)</span>. For example, estimate <span class="math inline">\(E(Y)\)</span> and <span class="math inline">\(P(Y\le y)\)</span> by <span class="math display">\[\begin{aligned}
\hat{E}(Y)&amp;=\frac{1}{N}\sum_{i=1}^NY_i,\\
\hat{P}(Y\le y )&amp;=\frac{1}{N}\sum_{i=1}^NI(Y_i\le y),\\
\end{aligned}\]</span> where <span class="math inline">\(I()\)</span> is the indicator function.</p></li>
</ol>
<p>Because each <span class="math inline">\(Y_i\)</span> is a random draw from the distribution of <span class="math inline">\(Y\)</span>, we must have <span class="math inline">\(E(Y_i)=E(Y)\)</span> and <span class="math inline">\(P(Y_i\le y)= P(Y \le y)\)</span> (in addition to <span class="math inline">\(Var(Y_i)=Var(Y)\)</span>), so the estimators above are unbiased: <span class="math display">\[\begin{align}
E\{\hat{E}(Y)\}&amp;=\frac{1}{N}\sum_{i=1}^NE(Y_i)\\&amp;=\frac{1}{N}\sum_{i=1}^NE(Y)\\&amp;=E(Y), \\
E\{\hat{P}(Y\le y )\}&amp;=\frac{1}{N}\sum_{i=1}^NE\{I(Y_i\le y)\}\\&amp;=\frac{1}{N}\sum_{i=1}^NP(Y_i\le y)\\
&amp;=\frac{1}{N}\sum_{i=1}^NP(Y\le y)\\&amp;=P(Y\le y).
\end{align}\]</span> The variances of the estimators decrease as we increase <span class="math inline">\(N\)</span>: <span class="math display">\[\begin{align}
Var\{\hat{E}(Y)\}&amp;=\frac{1}{N^2}\sum_{i=1}^NVar(Y_i)=\frac{1}{N^2}\sum_{i=1}^NVar(Y)=\frac{Var(Y)}{N}, \\
Var\{\hat{P}(Y\le y )\}&amp;=\frac{1}{N^2}\sum_{i=1}^NVar\{I(Y_i\le y)\}\\&amp;=\frac{1}{N^2}\sum_{i=1}^NP(Y_i\le y)\{1-P(Y_i\le y)\}\\
&amp;=\frac{1}{N^2}\sum_{i=1}^NP(Y\le y)\{1-P(Y\le y)\}\\ &amp;=\frac{P(Y\le y)\{1-P(Y\le y)\}
}{N}.
\end{align}\]</span> If <span class="math inline">\(N\)</span> is large, we can construct approximate confidence intervals based on the central limit theorem. For example, an approximate 95% confidence interval for <span class="math inline">\(E(Y)\)</span> would be <span class="math display">\[\hat{E}(Y) \pm 1.96 \sqrt{\frac{\widehat{Var}(Y)}{N}},\]</span> where <span class="math display">\[\widehat{Var}(Y)=\frac{1}{N-1}\sum_{i=1}^N\{Y_i-\hat{E}(Y)\}^2.\\\]</span></p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div id="exm-chisq2" class="theorem example">
<p><span class="theorem-title"><strong>Example 17.3</strong></span> Continuing <a href="#exm-chisq" class="quarto-xref">Example&nbsp;<span>17.1</span></a>, we show how this works in R. We estimate <span class="math inline">\(E(Y)\)</span> and <span class="math inline">\(P(Y&lt;1)\)</span> (which have true values of 1 and 0.683 to 3 d.p.)</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">61003</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate E(Y)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.046482</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence interval for E(Y)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>s.e <span class="ot">&lt;-</span> (<span class="fu">var</span>(y) <span class="sc">/</span> N)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">mean</span>(y) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> s.e, <span class="fu">mean</span>(y) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> s.e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9493342 1.1436297</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate  P(Y&lt;1)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y <span class="sc">&lt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.677</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence interval for P(Y&lt;1)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>s.e <span class="ot">&lt;-</span> (<span class="fu">mean</span>(y <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">mean</span>(y <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="sc">/</span> N)<span class="sc">^</span><span class="fl">0.5</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">mean</span>(y <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> s.e, <span class="fu">mean</span>(y <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> s.e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6480164 0.7059836</code></pre>
</div>
</div>
<p>Increasing <code>N</code> will give better results: the confidence intervals will be narrower, and we expect the estimates to be closer to the true values.</p>
</section>
<section id="probabilistic-uncertainty-analysis-in-health-economic-evaluation" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="probabilistic-uncertainty-analysis-in-health-economic-evaluation"><span class="header-section-number">17.2</span> Probabilistic uncertainty analysis in health economic evaluation</h2>
<p>The above technique is used in many disciplines. One area where it is (almost) a requirement is in health economic evaluations conducted for the National Institute for Health and Care Excellence (NICE). Below are some extracts from their guidance:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> (although they have used the term “probabilistic sensitivity analysis” to mean probabilistic uncertainty analysis. We will use the term sensitivity analysis to mean something else).</p>
<p>Some extracts for the guidance are as follows.</p>
<blockquote class="blockquote">
<p>A third source of uncertainty comes from parameter precision, once the most appropriate sources of information have been identified […] Assign distributions to characterise the uncertainty associated with [parameter/input] values. The distributions chosen for probabilistic sensitivity analysis should not be chosen arbitrarily but chosen to represent the available evidence on the parameter of interest, and their use should be justified</p>
</blockquote>
<blockquote class="blockquote">
<p>When doing a probabilistic analysis, enough model simulations should be used to minimise the effect of Monte Carlo error. Reviewing the variance around probabilistic model outputs […] as the number of simulations increases can provide a way of assessing if the model has been run enough times or more runs are needed.</p>
</blockquote>
<blockquote class="blockquote">
<p>Using univariate and best- or worst-case sensitivity analysis [one-at-a-time experiments] is an important way of identifying parameters that may have a substantial effect on the cost-effectiveness results and of explaining the key drivers of the model. However, such analyses become increasingly unhelpful in representing the combined effects of multiple sources of uncertainty as the number of parameters increase. Using probabilistic sensitivity analysis can allow a more comprehensive characterisation of the parameter uncertainty associated with all input parameters.</p>
</blockquote>
</section>
<section id="case-study" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="case-study"><span class="header-section-number">17.3</span> Case study</h2>
<p>We consider a (modified version of a) cost-effectiveness model that was developed to support the National Institute for Health and Care Excellence physical activity guidance<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. The model predicts the “incremental net benefit” of an intervention: exercise on prescription (e.g.&nbsp;from a general medical practitioner) to promote physical activity against a ‘do nothing’ scenario. The model assumes that the intervention affects health by reducing the risks of three diseases: coronary heart disease, stroke and diabetes. The health effects included in the model are those that relate to these three diseases, and the model counts costs that accrue as a result of the treatment of the three diseases, as well as those that relate to the intervention itself.</p>
<p>The incremental net benefit describes the value of the intervention per patient treated. Health benefits are converted into money, on an assumption that the NHS can afford to spend up to £20000 to achieve one extra year of life in perfect health for one patient. A positive incremental net benefit means the intervention is cost effective; a negative incremental net benefit means the money would be better spent on something else. Incremental net benefit is modelled for a cohort of patients with average age 50, at the time of the intervention.</p>
<p>The model has 24 uncertain inputs <span class="math inline">\(X_1,\ldots,X_{24}\)</span>. We do not list them all here, but examples include the relative risk of a stroke for an active versus a sedentary population, and the probability of new exercise in the intervention group. Further details and R code are available on Blackboard.</p>
<p>We illustrate a Monte Carlo uncertainty analysis. 100,000 random inputs are drawn from the distribution of <span class="math inline">\(\mathbf{x}\)</span>. The model is run at each input, to obtain a sample <span class="math inline">\(y_1,\ldots,y_{100000}\)</span> from the distribution of <span class="math inline">\(Y\)</span>. Note the interpretation of <span class="math inline">\(Y\)</span> here: it is the mean net benefit per patient treated. It is a fixed, uncertain quantity, because it is a function of 24 input values that are unknown.</p>
<p>We find <span class="math display">\[\begin{align}
\hat{E}(Y)&amp;=\frac{1}{100000}\sum_{i=1}^{100000}y_i=248.5\\
\hat{P}(Y\le 0 )&amp;=\frac{1}{100000}\sum_{i=1}^{100000}I(y_i\le 0)=0.225,
\end{align}\]</span> with 95% confidence intervals for <span class="math inline">\(E(Y)\)</span> and <span class="math inline">\(P(Y\le 0)\)</span> given by (246.4, 250.6) and (0.223, 0.228) respectively, suggesting that <span class="math inline">\(N=100000\)</span> is sufficiently large for estimating <span class="math inline">\(E(Y)\)</span> and <span class="math inline">\(P(Y\le 0)\)</span> reliably. Hence, although we may estimate that the intervention is cost-effective, based on <span class="math inline">\(E(Y)\)</span>, we are fairly uncertain about this; our probability that the intervention is <em>not</em> cost-effective is about 20%.</p>
<p>To visualise uncertainty about <span class="math inline">\(Y\)</span>, we can plot a (kernel) density estimate using the sample <span class="math inline">\(y_1,\ldots,y_{100000}\)</span>. We mark on the estimated 2.5th and 97.5th percentiles as vertical dashed lines.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Uncertainty-analysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>National Institute for Health and Care Excellence (2002). NICE health technology evaluations: the manual. Available at <a href="https://www.nice.org.uk/process/pmg36">https://www.nice.org.uk/process/pmg36</a>. See section <a href="https://www.nice.org.uk/process/pmg36/chapter/economic-evaluation-2#exploring-uncertainty">4.7 Exploring Uncertainty</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>National Institute for Clinical Excellence (2006) Four commonly used methods to increase physical activity: PH2. Technical Report. National Institute for Clinical Excellence, London. (Available from <a href="http://www.%20nice.org.uk/PH2">http://www. nice.org.uk/PH2</a>.) The version used in this case study is the model described in Strong, M., Oakley J. E. and Chilcott, J. (2012). <a href="https://doi.org/10.1111/j.1467-9876.2011.01014.x">Managing structural uncertainty in health economic decision models: a discrepancy approach</a>. Journal of the Royal Statistical Society, Series C, 61(1), 25-45. Thanks to Mark Strong for providing the R code.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Introduction-computer-experiments.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Sensitivity-analysis.html" class="pagination-link" aria-label="Sensitivity analysis">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Sensitivity analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>